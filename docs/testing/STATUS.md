# ILAL å¼€å‘è¿›åº¦æŠ¥å‘Š

**ç”Ÿæˆæ—¶é—´**: 2026-02-10  
**é¡¹ç›®çŠ¶æ€**: Phase 1-2 å·²å®Œæˆï¼Œè¿›å…¥æµ‹è¯•å’Œ ZK ç”µè·¯å¼€å‘é˜¶æ®µ

---

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### Phase 1: åŸºç¡€è®¾æ–½æ­å»º

- [x] é¡¹ç›®ç›®å½•ç»“æ„åˆ›å»º
- [x] Foundry é…ç½®æ–‡ä»¶ (`foundry.toml`)
- [x] ç¯å¢ƒå˜é‡æ¨¡æ¿ (`.env.example`)
- [x] Git å¿½ç•¥é…ç½® (`.gitignore`)
- [x] ä¾èµ–å®‰è£…è„šæœ¬ (`contracts/install-deps.sh`)
- [x] README å’Œ SETUP æ–‡æ¡£

### Phase 2: æ ¸å¿ƒåˆçº¦å¼€å‘

#### æ¥å£å®šä¹‰ âœ…
- [x] `IRegistry.sol` - é…ç½®ä¸­å¿ƒæ¥å£
- [x] `ISessionManager.sol` - ä¼šè¯ç®¡ç†æ¥å£
- [x] `IVerifier.sol` - ZK éªŒè¯å™¨æ¥å£
- [x] `IMessageSender.sol` - è·¯ç”±å™¨èº«ä»½æ¥å£
- [x] `IComplianceHook.sol` - Hook æ¥å£

#### æ ¸å¿ƒåˆçº¦å®ç° âœ…
- [x] **Registry.sol** - ä½¿ç”¨ UUPS ä»£ç†ï¼Œæ”¯æŒå¯å‡çº§
  - Issuer æ³¨å†Œ/æ›´æ–°/æ’¤é”€
  - è·¯ç”±å™¨ç™½åå•ç®¡ç†
  - Session TTL å‚æ•°é…ç½®
  - ç´§æ€¥æš‚åœæœºåˆ¶
  
- [x] **SessionManager.sol** - ä½¿ç”¨ UUPS ä»£ç†
  - ä¼šè¯ç¼“å­˜ (24h TTL)
  - AccessControl è§’è‰²ç®¡ç†
  - æ‰¹é‡æ“ä½œæ”¯æŒ
  - Gas ä¼˜åŒ– (O(1) æŸ¥è¯¢)
  
- [x] **MockVerifier.sol** - å¼€å‘ç¯å¢ƒéªŒè¯å™¨
  - ç™½åå•æ¨¡å¼
  - æµ‹è¯•è¾…åŠ©å‡½æ•°
  - âš ï¸ ç”Ÿäº§ç¯å¢ƒéœ€æ›¿æ¢ä¸ºçœŸå® ZK Verifier
  
- [x] **ComplianceHook.sol** - å‡†å…¥æ§åˆ¶ Hook
  - `beforeSwap` / `beforeAddLiquidity` / `beforeRemoveLiquidity`
  - hookData ç”¨æˆ·åœ°å€è§£æ
  - ç´§æ€¥æš‚åœæ£€æŸ¥
  - è·¯ç”±å™¨ç™½åå•éªŒè¯

#### å•å…ƒæµ‹è¯• âœ…
- [x] `Registry.t.sol` - å…¨é¢æµ‹è¯• Issuer ç®¡ç†å’Œå‚æ•°é…ç½®
- [x] `SessionManager.t.sol` - æµ‹è¯•ä¼šè¯ç”Ÿå‘½å‘¨æœŸå’Œ Gas ä¼˜åŒ–
- [x] `ComplianceHook.t.sol` - æµ‹è¯•å‡†å…¥æ§åˆ¶é€»è¾‘

#### éƒ¨ç½²è„šæœ¬ âœ…
- [x] `Deploy.s.sol` - å®Œæ•´éƒ¨ç½²æµç¨‹
  - UUPS ä»£ç†éƒ¨ç½²
  - åˆå§‹åŒ–é…ç½®
  - Coinbase Issuer æ³¨å†Œ
  - éƒ¨ç½²åœ°å€ä¿å­˜

---

## ğŸš§ è¿›è¡Œä¸­çš„å·¥ä½œ

### Phase 0: å…³é”®å†³ç­–

**âš ï¸ éœ€è¦åœ¨ç»§ç»­å‰å®Œæˆä»¥ä¸‹å†³ç­–ï¼š**

#### å†³ç­– 1: ZK ç®—æ³•é€‰æ‹© (1-2 å¤©)
- [ ] è¯„ä¼° Groth16 vs PLONK çš„ Gas å·®å¼‚
- [ ] è¯„ä¼°å›¢é˜Ÿ Trusted Setup èƒ½åŠ›
- [ ] ç¡®å®šç”µè·¯å¯èƒ½çš„è¿­ä»£é¢‘ç‡
- **è¾“å‡º**: é€‰å®šç®—æ³•å¹¶æ›´æ–° Phase 3 è®¡åˆ’

#### å†³ç­– 2: Hook èº«ä»½è§£æ PoC (3-5 å¤©)
- [ ] éªŒè¯ Uniswap Universal Router hookData æ”¯æŒ
- [ ] æµ‹è¯•å‰ç«¯å¦‚ä½•æ„é€  hookData
- [ ] è®¾è®¡ EIP-712 ç­¾åéªŒè¯ (å¦‚éœ€è¦)
- **è¾“å‡º**: ç¡®å®šæœ€ç»ˆ `_resolveUser` å®ç°æ–¹æ¡ˆ

#### å†³ç­– 3: åˆçº¦å‡çº§ç­–ç•¥ âœ…
- [x] ä½¿ç”¨ UUPS ä»£ç†æ¨¡å¼
- [x] Registry å’Œ SessionManager å·²å®ç°å¯å‡çº§

---

## ğŸ“‹ å¾…å®Œæˆçš„ä»»åŠ¡

### ç«‹å³éœ€è¦ (é˜»å¡åç»­å¼€å‘)

1. **å®‰è£… Foundry** (5 åˆ†é’Ÿ)
   ```bash
   curl -L https://foundry.paradigm.xyz | bash
   foundryup
   ```

2. **å®‰è£…åˆçº¦ä¾èµ–** (10 åˆ†é’Ÿ)
   ```bash
   cd contracts
   ./install-deps.sh
   ```

3. **éªŒè¯æµ‹è¯•é€šè¿‡** (5 åˆ†é’Ÿ)
   ```bash
   cd contracts
   forge test -vvv
   ```

### Phase 3: ZK ç”µè·¯å¼€å‘ (2-3 å‘¨)

- [ ] è®¾è®¡ Circom ç”µè·¯ (ç­¾åéªŒè¯ + Merkle è¯æ˜)
- [ ] æ‰§è¡Œ Trusted Setup (æˆ–é€‰æ‹© PLONK)
- [ ] ç”Ÿæˆ Solidity Verifier
- [ ] æ›¿æ¢ MockVerifier

### Phase 4: å‰ç«¯å¼€å‘ (2-3 å‘¨)

- [ ] Next.js é¡¹ç›®åˆå§‹åŒ–
- [ ] é’±åŒ…è¿æ¥ (RainbowKit)
- [ ] ZK Proof ç”Ÿæˆ (Web Worker)
- [ ] éªŒè¯æµç¨‹ UI
- [ ] äº¤æ˜“ç•Œé¢

### Phase 5: å­å›¾ç´¢å¼• (1 å‘¨)

- [ ] Schema å®šä¹‰
- [ ] äº‹ä»¶å¤„ç†å™¨
- [ ] éƒ¨ç½²åˆ° The Graph

### Phase 6: é›†æˆæµ‹è¯• (2-3 å‘¨)

- [ ] ç«¯åˆ°ç«¯æµ‹è¯•
- [ ] Invariant Testing (Fuzz)
- [ ] Gas ä¼˜åŒ–æµ‹è¯•
- [ ] ç´§æ€¥åœºæ™¯æµ‹è¯•

### Phase 7: éƒ¨ç½² (1 å‘¨)

- [ ] Base Sepolia æµ‹è¯•ç½‘éƒ¨ç½²
- [ ] å®‰å…¨å®¡è®¡
- [ ] Base Mainnet éƒ¨ç½²
- [ ] åˆçº¦éªŒè¯

### Phase 8: è¿ç»´å·¥å…· (1 å‘¨)

- [ ] ç›‘æ§è„šæœ¬
- [ ] è‡ªåŠ¨åŒ–åšå¸‚æœºå™¨äºº
- [ ] æ–‡æ¡£å®Œå–„

---

## ğŸ“Š å½“å‰çŠ¶æ€ç»Ÿè®¡

- **åˆçº¦æ•°é‡**: 8 ä¸ª (5 æ ¸å¿ƒ + 3 æµ‹è¯•)
- **æµ‹è¯•ç”¨ä¾‹**: 40+ ä¸ª
- **ä»£ç è¦†ç›–ç‡**: å¾…è¿è¡Œ `forge coverage`
- **Gas æŠ¥å‘Š**: å¾…è¿è¡Œ `forge test --gas-report`

---

## âš ï¸ å…³é”®æé†’

### ç”Ÿäº§ç¯å¢ƒå‰å¿…é¡»å®Œæˆ

1. **æ›¿æ¢ MockVerifier** ğŸ”´
   - å½“å‰ä½¿ç”¨çš„æ˜¯æµ‹è¯•ç”¨çš„ Mock éªŒè¯å™¨
   - å¿…é¡»åœ¨ä¸»ç½‘éƒ¨ç½²å‰æ›¿æ¢ä¸ºçœŸå®çš„ Groth16/PLONK Verifier

2. **Hook PoC éªŒè¯** ğŸ”´
   - `_resolveUser` ä¸­çš„ hookData æ–¹æ¡ˆéœ€è¦å®é™…éªŒè¯
   - å¯èƒ½éœ€è¦è°ƒæ•´å®ç°ç­–ç•¥

3. **EIP-712 ç­¾å** ğŸŸ¡
   - å½“å‰ hookData è§£æç¼ºå°‘ç­¾åéªŒè¯
   - ç”Ÿäº§ç¯å¢ƒéœ€è¦æ·»åŠ é˜²ä¼ªé€ æœºåˆ¶

4. **Uniswap v4 åœ°å€** ğŸŸ¡
   - éƒ¨ç½²è„šæœ¬ä¸­çš„ PoolManager å’Œ Router åœ°å€å¾…æ›´æ–°

5. **å®‰å…¨å®¡è®¡** ğŸ”´
   - æ‰€æœ‰åˆçº¦å¿…é¡»ç»è¿‡ä¸“ä¸šå®¡è®¡
   - ç‰¹åˆ«å…³æ³¨ UUPS å‡çº§é€»è¾‘å’Œ Hook å‡†å…¥æ§åˆ¶

---

## ğŸš€ å¿«é€Ÿå¼€å§‹æŒ‡å—

### å¯¹äºå¼€å‘è€…

```bash
# 1. å…‹éš†é¡¹ç›®
cd /Users/ronny/Desktop/ilal

# 2. å®‰è£… Foundry
curl -L https://foundry.paradigm.xyz | bash
foundryup

# 3. å®‰è£…ä¾èµ–
cd contracts
./install-deps.sh

# 4. è¿è¡Œæµ‹è¯•
forge test -vvv

# 5. æŸ¥çœ‹ Gas æŠ¥å‘Š
forge test --gas-report

# 6. éƒ¨ç½²åˆ°æœ¬åœ°æµ‹è¯•
anvil  # åœ¨å¦ä¸€ä¸ªç»ˆç«¯
forge script script/Deploy.s.sol --rpc-url http://127.0.0.1:8545 --broadcast
```

### å¯¹äºé¡¹ç›®ç»ç†

å½“å‰å·²å®Œæˆ **Phase 1-2** çš„æ‰€æœ‰æ ¸å¿ƒåˆçº¦å¼€å‘ï¼Œè¿›å…¥ **Phase 3** ZK ç”µè·¯å¼€å‘é˜¶æ®µã€‚

**å…³é”®è·¯å¾„ä¾èµ–**:
1. å¿…é¡»å…ˆå®Œæˆ Phase 0 çš„ä¸‰ä¸ªæŠ€æœ¯å†³ç­–
2. ZK ç”µè·¯å¼€å‘æ˜¯å‰ç«¯éªŒè¯æµç¨‹çš„å‰ç½®æ¡ä»¶
3. Hook PoC éªŒè¯å½±å“ ComplianceHook æœ€ç»ˆå®ç°

**é¢„è®¡æ—¶é—´çº¿** (åœ¨å®Œæˆ Phase 0 å†³ç­–å):
- Phase 3 (ZK): 2-3 å‘¨
- Phase 4 (å‰ç«¯): 2-3 å‘¨
- Phase 5 (å­å›¾): 1 å‘¨
- Phase 6 (æµ‹è¯•): 2-3 å‘¨
- Phase 7 (éƒ¨ç½²): 1 å‘¨

**æ€»è®¡**: 8-11 å‘¨ (çº¦ 2-2.5 ä¸ªæœˆ)

---

## ğŸ“ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### æœ¬å‘¨ä»»åŠ¡

1. **æŠ€æœ¯å›¢é˜Ÿ**: 
   - å®‰è£… Foundry å¹¶éªŒè¯æµ‹è¯•é€šè¿‡
   - å¼€å§‹ Phase 0 å†³ç­– 1 (ZK ç®—æ³•é€‰æ‹©)
   - å¯åŠ¨ Hook PoC å¼€å‘

2. **äº§å“å›¢é˜Ÿ**:
   - å®¡æŸ¥å½“å‰åˆçº¦è®¾è®¡
   - ç¡®è®¤åˆè§„é€»è¾‘æ˜¯å¦æ»¡è¶³éœ€æ±‚
   - å‡†å¤‡å‰ç«¯ UI/UX è®¾è®¡

3. **é¡¹ç›®ç»ç†**:
   - ç»„ç»‡ Phase 0 å†³ç­–ä¼šè®®
   - è·Ÿè¸ªé˜»å¡é—®é¢˜è§£å†³è¿›åº¦
   - æ›´æ–°é¡¹ç›®æ—¶é—´è¡¨

---

## ğŸ“ è”ç³»æ–¹å¼

- **æŠ€æœ¯æ–‡æ¡£**: æŸ¥çœ‹ [SETUP.md](SETUP.md) å’Œ [README.md](README.md)
- **å¼€å‘è®¡åˆ’**: æŸ¥çœ‹ `.cursor/plans/ilal_å®Œæ•´å¼€å‘è®¡åˆ’_*.plan.md`
- **PRD æ–‡æ¡£**: æŸ¥çœ‹ `docs/PRD.md` (å¾…åˆ›å»º)

---

**æœ€åæ›´æ–°**: 2026-02-10  
**æ›´æ–°äºº**: AI Development Assistant
