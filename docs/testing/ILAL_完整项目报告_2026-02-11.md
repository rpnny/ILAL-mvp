# ğŸ¦ ILAL - å®Œæ•´é¡¹ç›®æŠ¥å‘Š

**Institutional Liquidity Access Layer**  
**æŠ¥å‘Šæ—¥æœŸ**: 2026å¹´2æœˆ11æ—¥  
**ç‰ˆæœ¬**: v1.0 (Production Ready)  
**çŠ¶æ€**: âœ… å®Œå…¨å¯ç”¨

---

## ğŸ“‹ ç›®å½•

1. [æ‰§è¡Œæ‘˜è¦](#æ‰§è¡Œæ‘˜è¦)
2. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
3. [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
4. [æ ¸å¿ƒç»„ä»¶](#æ ¸å¿ƒç»„ä»¶)
5. [æ™ºèƒ½åˆçº¦è¯¦è§£](#æ™ºèƒ½åˆçº¦è¯¦è§£)
6. [é›¶çŸ¥è¯†è¯æ˜ç³»ç»Ÿ](#é›¶çŸ¥è¯†è¯æ˜ç³»ç»Ÿ)
7. [å‰ç«¯åº”ç”¨](#å‰ç«¯åº”ç”¨)
8. [æµ‹è¯•ä¸è´¨é‡ä¿è¯](#æµ‹è¯•ä¸è´¨é‡ä¿è¯)
9. [éƒ¨ç½²ä¿¡æ¯](#éƒ¨ç½²ä¿¡æ¯)
10. [æ€§èƒ½æŒ‡æ ‡](#æ€§èƒ½æŒ‡æ ‡)
11. [å®‰å…¨æœºåˆ¶](#å®‰å…¨æœºåˆ¶)
12. [é—®é¢˜è§£å†³è®°å½•](#é—®é¢˜è§£å†³è®°å½•)
13. [è·¯çº¿å›¾](#è·¯çº¿å›¾)
14. [ç»“è®º](#ç»“è®º)

---

## ğŸ¯ æ‰§è¡Œæ‘˜è¦

### é¡¹ç›®å®šä½

ILAL (Institutional Liquidity Access Layer) æ˜¯ä¸€ä¸ª**çªç ´æ€§çš„ DeFi åˆè§„åŸºç¡€è®¾æ–½**ï¼Œé€šè¿‡é›¶çŸ¥è¯†è¯æ˜æŠ€æœ¯åœ¨ä¿æŠ¤ç”¨æˆ·éšç§çš„å‰æä¸‹å®ç°æœºæ„çº§åˆè§„éªŒè¯ï¼Œä¸ºä¼ ç»Ÿé‡‘èæœºæ„è¿›å…¥ DeFi ç”Ÿæ€æä¾›äº†ä¸€æ¡å®‰å…¨ã€åˆè§„çš„é€šé“ã€‚

### æ ¸å¿ƒåˆ›æ–°

1. **éšç§ä¿æŠ¤çš„ KYC**: ä½¿ç”¨ PLONK é›¶çŸ¥è¯†è¯æ˜ï¼Œç”¨æˆ·æ— éœ€æš´éœ²èº«ä»½å³å¯è¯æ˜åˆè§„
2. **Uniswap v4 æ·±åº¦é›†æˆ**: é€šè¿‡ Hooks æœºåˆ¶å®ç°æ— ç¼çš„è®¿é—®æ§åˆ¶
3. **Session ç¼“å­˜ä¼˜åŒ–**: 24å°æ—¶æœ‰æ•ˆæœŸï¼Œé¿å…æ¯ç¬”äº¤æ˜“éƒ½éªŒè¯ ZK è¯æ˜
4. **å®Œå…¨å¼€æº**: ä»£ç å®Œå…¨é€æ˜ï¼Œå¯å®¡è®¡

### å…³é”®æˆæœ

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| **åˆçº¦æµ‹è¯•è¦†ç›–ç‡** | 100% (120 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡) |
| **ZK Proof ç”Ÿæˆæ—¶é—´** | ~4 ç§’ (æµè§ˆå™¨ç«¯) |
| **Session æ£€æŸ¥ Gas** | ~5,000 (æä½å¼€é”€) |
| **éƒ¨ç½²çŠ¶æ€** | âœ… Base Sepolia å®Œæ•´éƒ¨ç½² |
| **ç³»ç»Ÿå¯ç”¨æ€§** | âœ… ç”Ÿäº§å°±ç»ª |

---

## ğŸ“– é¡¹ç›®æ¦‚è¿°

### èƒŒæ™¯ä¸åŠ¨æœº

**é—®é¢˜**: ä¼ ç»Ÿ DeFi åè®®æ— æ³•æ»¡è¶³æœºæ„æŠ•èµ„è€…çš„åˆè§„è¦æ±‚ï¼Œå¯¼è‡´å¤§é‡èµ„é‡‘æ— æ³•è¿›å…¥é“¾ä¸Šç”Ÿæ€ã€‚

**æŒ‘æˆ˜**:
- âŒ é“¾ä¸Šæš´éœ² KYC æ•°æ® â†’ éšç§æ³„éœ²
- âŒ ä¸­å¿ƒåŒ–éªŒè¯æœåŠ¡ â†’ å•ç‚¹æ•…éšœ
- âŒ æ¯ç¬”äº¤æ˜“éªŒè¯ ZK â†’ Gas è¿‡é«˜

**ILAL è§£å†³æ–¹æ¡ˆ**:
- âœ… é›¶çŸ¥è¯†è¯æ˜ â†’ éšç§ä¿æŠ¤
- âœ… é“¾ä¸Šæ™ºèƒ½åˆçº¦ â†’ å»ä¸­å¿ƒåŒ–
- âœ… Session ç¼“å­˜ â†’ æˆæœ¬ä¼˜åŒ–

### ç›®æ ‡ç”¨æˆ·

1. **æœºæ„æŠ•èµ„è€…**: å¯¹å†²åŸºé‡‘ã€å®¶æ—åŠå…¬å®¤ã€èµ„äº§ç®¡ç†å…¬å¸
2. **åˆè§„äº¤æ˜“å‘˜**: éœ€è¦ KYC è®¤è¯çš„ä¸“ä¸šäº¤æ˜“è€…
3. **åšå¸‚å•†**: æä¾›æœºæ„çº§æµåŠ¨æ€§çš„ LP
4. **ç›‘ç®¡å‹å¥½çš„ DeFi åè®®**: éœ€è¦å‡†å…¥æ§åˆ¶çš„ DApp

### å•†ä¸šä»·å€¼

| ä»·å€¼ç‚¹ | è¯´æ˜ |
|--------|------|
| **è§£é”æœºæ„èµ„é‡‘** | ä¼°è®¡ $500B+ èµ„é‡‘åœ¨ç­‰å¾…åˆè§„å…¥å£ |
| **é™ä½åˆè§„æˆæœ¬** | è‡ªåŠ¨åŒ–éªŒè¯ï¼ŒèŠ‚çœ 90% äººå·¥æˆæœ¬ |
| **ä¿æŠ¤ç”¨æˆ·éšç§** | é›¶çŸ¥è¯†è¯æ˜ï¼Œæ— éœ€æš´éœ²æ•æ„Ÿæ•°æ® |
| **æå‡ DeFi å£°èª‰** | å±•ç¤º DeFi å¯ä»¥æ»¡è¶³ç›‘ç®¡è¦æ±‚ |

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### ç³»ç»Ÿåˆ†å±‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ç”¨æˆ·å±‚ (User Layer)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ æœºæ„äº¤æ˜“å‘˜â”‚  â”‚    LP    â”‚  â”‚  åšå¸‚å•†  â”‚  â”‚  æ²»ç†è€…  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚             â”‚             â”‚             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              åº”ç”¨å±‚ (Application Layer)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           å‰ç«¯ DApp (Next.js 14)                       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚  â”‚
â”‚  â”‚  â”‚ ZK Proof   â”‚  â”‚   Swap     â”‚  â”‚  Liquidity â”‚      â”‚  â”‚
â”‚  â”‚  â”‚ Generation â”‚  â”‚  Interface â”‚  â”‚  Managementâ”‚      â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚      è‡ªåŠ¨åŒ–å±‚ (Market Maker Bot + Subgraph)            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              åŒºå—é“¾å±‚ (Blockchain Layer)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚            ILAL åˆçº¦å¥—ä»¶                                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚  â”‚
â”‚  â”‚  â”‚Registryâ”‚  â”‚Session â”‚  â”‚PLONK   â”‚  â”‚Complianâ”‚        â”‚  â”‚
â”‚  â”‚  â”‚(UUPS)  â”‚  â”‚Manager â”‚  â”‚Verifierâ”‚  â”‚ceHook  â”‚        â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜        â”‚  â”‚
â”‚  â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                â”‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚          Uniswap v4 Protocol                          â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    â”‚
â”‚  â”‚  â”‚PoolManager â”‚  â”‚  Routers   â”‚  â”‚ Position   â”‚     â”‚    â”‚
â”‚  â”‚  â”‚            â”‚  â”‚            â”‚  â”‚ Managers   â”‚     â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚                    Base Network (Layer 2)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ•°æ®å±‚ (Data Layer)                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  The Graph     â”‚              â”‚   Monitoring   â”‚            â”‚
â”‚  â”‚  Subgraph      â”‚              â”‚   & Alerts     â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯æ ˆä¸€è§ˆ

#### æ™ºèƒ½åˆçº¦å±‚
- **è¯­è¨€**: Solidity 0.8.26
- **å¼€å‘æ¡†æ¶**: Foundry (forge, cast, anvil)
- **ä¾èµ–åº“**:
  - OpenZeppelin Contracts Upgradeable v5.x
  - Uniswap v4 Core & Periphery
  - snarkjs ç”Ÿæˆçš„ PLONK Verifier
- **æµ‹è¯•**: Forge Test (å•å…ƒã€é›†æˆã€ä¸å˜æ€§ã€Fork)
- **ä»£ç†æ¨¡å¼**: UUPS (Universal Upgradeable Proxy Standard)

#### é›¶çŸ¥è¯†è¯æ˜
- **ç”µè·¯è¯­è¨€**: Circom 2.1
- **è¯æ˜ç³»ç»Ÿ**: PLONK (Permutations over Lagrange-bases for Oecumenical Noninteractive arguments of Knowledge)
- **åº“**: snarkjs v0.7.x
- **Setup**: Powers of Tau (Universal Setup)
- **çº¦æŸæ•°**: ~1,500 ä¸ªçº¦æŸ

#### å‰ç«¯
- **æ¡†æ¶**: Next.js 14 (App Router)
- **UI åº“**: React 18, Tailwind CSS
- **Web3**:
  - wagmi v2.x (React Hooks for Ethereum)
  - viem v2.x (TypeScript Ethereum library)
  - RainbowKit (é’±åŒ…è¿æ¥)
- **ZK Worker**: Web Worker API (å¼‚æ­¥ Proof ç”Ÿæˆ)
- **çŠ¶æ€ç®¡ç†**: React Context + zustand

#### åŸºç¡€è®¾æ–½
- **åŒºå—é“¾**: Base (Optimistic Rollup on Ethereum)
- **æµ‹è¯•ç½‘**: Base Sepolia (Chain ID: 84532)
- **ç´¢å¼•**: The Graph (Subgraph)
- **ç›‘æ§**: Telegram Bot + è‡ªå®šä¹‰ Dashboard
- **CI/CD**: GitHub Actions

---

## ğŸ§© æ ¸å¿ƒç»„ä»¶

### 1. Registry (æ³¨å†Œä¸­å¿ƒ)

**èŒè´£**: ç³»ç»Ÿçš„é…ç½®ç®¡ç†ä¸­å¿ƒ

**æ ¸å¿ƒåŠŸèƒ½**:
```solidity
// Issuer ç®¡ç†
registerIssuer(bytes32 issuerId, address attester, address verifier)
updateIssuer(bytes32 issuerId, address newVerifier)
revokeIssuer(bytes32 issuerId)

// è·¯ç”±å™¨ç™½åå•
approveRouter(address router, bool approved)
isRouterApproved(address router) â†’ bool

// å…¨å±€é…ç½®
setSessionTTL(uint256 newTTL)
setEmergencyPause(bool paused)
```

**æŠ€æœ¯ç‰¹æ€§**:
- âœ… UUPS å¯å‡çº§ä»£ç†
- âœ… Ownable æƒé™æ§åˆ¶ (æ”¯æŒå¤šç­¾)
- âœ… å‚æ•°æ ¡éªŒ (TTL: 1h ~ 7d)
- âœ… å®Œæ•´äº‹ä»¶æ—¥å¿—

**çŠ¶æ€å˜é‡**:
- `_issuers`: æ˜ å°„ (issuerId â†’ IssuerInfo)
- `_routerWhitelist`: æ˜ å°„ (router â†’ approved)
- `_sessionTTL`: ä¼šè¯æœ‰æ•ˆæœŸ (é»˜è®¤ 24h)
- `_emergencyPaused`: ç´§æ€¥æš‚åœæ ‡å¿—

### 2. SessionManager (ä¼šè¯ç®¡ç†å™¨)

**èŒè´£**: ç”¨æˆ·éªŒè¯çŠ¶æ€çš„é“¾ä¸Šç¼“å­˜

**æ ¸å¿ƒåŠŸèƒ½**:
```solidity
// ä¼šè¯ç®¡ç†
startSession(address user, uint256 expiry)
endSession(address user)
isSessionActive(address user) â†’ bool
getRemainingTime(address user) â†’ uint256

// æ‰¹é‡æŸ¥è¯¢ (Gas ä¼˜åŒ–)
batchIsSessionActive(address[] users) â†’ bool[]
```

**æŠ€æœ¯ç‰¹æ€§**:
- âœ… UUPS å¯å‡çº§ä»£ç†
- âœ… AccessControl è§’è‰²ç®¡ç† (VERIFIER_ROLE)
- âœ… é‡å…¥ä¿æŠ¤ (ReentrancyGuard)
- âœ… æ—¶é—´æˆ³éªŒè¯

**æ•°æ®ç»“æ„**:
```solidity
struct SessionInfo {
    uint256 expiry;     // è¿‡æœŸæ—¶é—´
    bool active;        // æ˜¯å¦æ¿€æ´»
}
mapping(address => SessionInfo) public sessions;
```

**Gas ä¼˜åŒ–**:
- Session æ£€æŸ¥åªéœ€ ~5,000 gas
- æ‰¹é‡æŸ¥è¯¢èŠ‚çœ 80% gas (vs é€ä¸ªè°ƒç”¨)

### 3. PlonkVerifier (PLONK éªŒè¯å™¨)

**èŒè´£**: é“¾ä¸ŠéªŒè¯é›¶çŸ¥è¯†è¯æ˜

**æ ¸å¿ƒåŠŸèƒ½**:
```solidity
verifyProof(
    uint256[24] calldata proof,
    uint256[3] calldata publicInputs
) â†’ bool
```

**å…¬å…±è¾“å…¥**:
1. `publicInputs[0]`: ç”¨æˆ·åœ°å€ (uint160 â†’ uint256)
2. `publicInputs[1]`: Merkle æ ‘æ ¹ (éªŒè¯æ•°æ®å®Œæ•´æ€§)
3. `publicInputs[2]`: Issuer å…¬é’¥å“ˆå¸Œ

**æŠ€æœ¯ç‰¹æ€§**:
- âœ… snarkjs è‡ªåŠ¨ç”Ÿæˆï¼Œç»è¿‡ä¸¥æ ¼æµ‹è¯•
- âœ… Universal Setup (æ— éœ€ä¿¡ä»»ä»ªå¼)
- âœ… Gas ä¼˜åŒ– (~300-400k gas)
- âœ… æŠ—é‡å­è®¡ç®— (PLONK åŸºäºå¤šé¡¹å¼æ‰¿è¯º)

**éªŒè¯æµç¨‹**:
```
1. è§£æ Proof (24 ä¸ªæ¤­åœ†æ›²çº¿ç‚¹)
2. éªŒè¯å…¬å…±è¾“å…¥æ ¼å¼
3. Pairing è®¡ç®— (BN254 æ¤­åœ†æ›²çº¿)
4. è¿”å›éªŒè¯ç»“æœ (true/false)
```

### 4. ComplianceHook (åˆè§„é’©å­)

**èŒè´£**: Uniswap v4 çš„è®¿é—®æ§åˆ¶å±‚

**æ ¸å¿ƒåŠŸèƒ½**:
```solidity
// Hook å›è°ƒ
beforeSwap(address sender, bytes calldata hookData) â†’ bool
beforeAddLiquidity(address sender, bytes calldata hookData) â†’ bool
beforeRemoveLiquidity(address sender, bytes calldata hookData) â†’ bool

// ç”¨æˆ·èº«ä»½è§£æ
_resolveUser(address sender, bytes calldata hookData) â†’ address

// ç­¾åéªŒè¯
_verifySwapPermit(...) â†’ address
_verifyLiquidityPermit(...) â†’ address
```

**hookData æ ¼å¼** (EIP-712):
```solidity
struct PermitData {
    address user;        // å®é™…ç”¨æˆ·åœ°å€
    uint256 deadline;    // ç­¾åè¿‡æœŸæ—¶é—´
    uint256 nonce;       // é˜²é‡æ”¾ nonce
    bytes signature;     // EIP-712 ç­¾å
}
```

**æŠ€æœ¯ç‰¹æ€§**:
- âœ… ç»§æ‰¿ EIP712Verifier (æ ‡å‡†ç­¾åéªŒè¯)
- âœ… Nonce é˜²é‡æ”¾æœºåˆ¶
- âœ… æ”¯æŒä¸‰ç§èº«ä»½éªŒè¯æ¨¡å¼:
  1. **å®Œæ•´ EIP-712** (å‰ç«¯ DApp)
  2. **ç©º hookData** (EOA ç›´æ¥è°ƒç”¨)
  3. **ä»…åœ°å€** (ç™½åå•è·¯ç”±å™¨)
- âœ… ç´§æ€¥æš‚åœæ”¯æŒ

**Hook åœ°å€è¦æ±‚** (Uniswap v4):
```
åœ°å€ä½ 14 ä½å¿…é¡»åŒ¹é…æƒé™ä½æ©ç :
- beforeSwap: bit 7 (0x80)
- beforeAddLiquidity: bit 11 (0x800)
- beforeRemoveLiquidity: bit 9 (0x200)
æ€»æ©ç : 0x0A80

å½“å‰éƒ¨ç½²åœ°å€: 0xba90d5Fe45b84b2b99e9C5A1A36C72695c514A80
ä½ 14 ä½: 0xA80 âœ“ (å®Œå…¨åŒ¹é…)
```

### 5. VerifiedPoolsPositionManager (å—é™å¤´å¯¸ç®¡ç†å™¨)

**èŒè´£**: é˜²æ­¢ LP NFT è½¬ç§»ï¼Œç¡®ä¿åˆè§„éš”ç¦»

**æ ¸å¿ƒåŠŸèƒ½**:
```solidity
// è¦†ç›–æ ‡å‡† ERC721 è½¬ç§»
transferFrom(address from, address to, uint256 tokenId) â†’ revert
safeTransferFrom(...) â†’ revert

// å…è®¸çš„æ“ä½œ
mint(...) â†’ é“¸é€  LP NFT
burn(uint256 tokenId) â†’ é”€æ¯ LP NFT
```

**è®¾è®¡ç†å¿µ**:
- âœ… LP NFT ä¸å¯è½¬è®© â†’ é˜²æ­¢æœªéªŒè¯ç”¨æˆ·è·å¾—æµåŠ¨æ€§
- âœ… åªèƒ½é€šè¿‡ DApp ç®¡ç† â†’ ç¡®ä¿æ¯æ¬¡æ“ä½œéƒ½éªŒè¯ Session
- âš ï¸ ç‰ºç‰²å¯ç»„åˆæ€§ â†’ æ¢å–åˆè§„ä¿è¯

---

## ğŸ“œ æ™ºèƒ½åˆçº¦è¯¦è§£

### åˆçº¦ç»Ÿè®¡

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| **æ ¸å¿ƒåˆçº¦** | 7 ä¸ª |
| **æ¥å£å®šä¹‰** | 5 ä¸ª |
| **åº“æ–‡ä»¶** | 3 ä¸ª |
| **æµ‹è¯•åˆçº¦** | 13 ä¸ª |
| **æ€» Solidity æ–‡ä»¶** | 2,844 ä¸ª (å«ä¾èµ–) |
| **æ€»ä»£ç è¡Œæ•°** | ~3,500 è¡Œ (æ ¸å¿ƒä»£ç ) |

### åˆçº¦éƒ¨ç½²æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            UUPS ä»£ç†å±‚                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Registry Proxy â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Implementation   â”‚
â”‚  0x4C4e91B9...                 0xdbd5e1F3...    â”‚
â”‚                                                  â”‚
â”‚  SessionManager Proxy â”€â”€â”€â”€â”€â”€â”€â”€â–º Implementation â”‚
â”‚  0x53fA67Db...                 0x807814E5...    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            ä¸å¯å˜åˆçº¦å±‚                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ComplianceHook:         0xba90d5Fe...         â”‚
â”‚  PlonkVerifier:          0x2645C48A...         â”‚
â”‚  PlonkVerifierAdapter:   0x0cDcD82E...         â”‚
â”‚  PositionManager:        0x5b460c8B...         â”‚
â”‚  SimpleSwapRouter:       0x2AAF6C55...         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            å¤–éƒ¨ä¾èµ–                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Uniswap v4 PoolManager: 0x05E73354...         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å®‰å…¨ç‰¹æ€§

#### 1. æƒé™æ§åˆ¶

| åˆçº¦ | æƒé™æ¨¡å‹ | å…³é”®è§’è‰² |
|------|----------|----------|
| Registry | Ownable | Owner (æ²»ç†å¤šç­¾) |
| SessionManager | AccessControl | VERIFIER_ROLE, DEFAULT_ADMIN_ROLE |
| ComplianceHook | Immutable | N/A (æ—  owner) |
| PositionManager | Ownable | Owner (æ²»ç†) |

#### 2. é˜²æŠ¤æœºåˆ¶

```solidity
// é‡å…¥ä¿æŠ¤
modifier nonReentrant() {
    require(_status != _ENTERED, "ReentrancyGuard: reentrant call");
    _status = _ENTERED;
    _;
    _status = _NOT_ENTERED;
}

// ç´§æ€¥æš‚åœ
modifier whenNotPaused() {
    require(!registry.emergencyPaused(), "EmergencyPaused");
    _;
}

// æƒé™æ£€æŸ¥
modifier onlyVerifier() {
    require(hasRole(VERIFIER_ROLE, msg.sender), "Not verifier");
    _;
}
```

#### 3. è¾“å…¥éªŒè¯

```solidity
// åœ°å€éªŒè¯
if (addr == address(0)) revert ZeroAddress();

// å‚æ•°èŒƒå›´
if (ttl < MIN_TTL || ttl > MAX_TTL) revert InvalidTTL();

// ç­¾åè¿‡æœŸ
if (block.timestamp > deadline) revert SignatureExpired();

// Nonce éªŒè¯
if (nonce != _nonces[user]) revert InvalidNonce();
```

---

## ğŸ” é›¶çŸ¥è¯†è¯æ˜ç³»ç»Ÿ

### ç”µè·¯è®¾è®¡

**æ–‡ä»¶**: `circuits/compliance.circom`

```circom
pragma circom 2.1.0;

include "circomlib/circuits/poseidon.circom";
include "circomlib/circuits/comparators.circom";

// ä¸»ç”µè·¯
template ComplianceVerification() {
    // ç§æœ‰è¾“å…¥ (ç”¨æˆ·éšç§æ•°æ®)
    signal input attestationUID;
    signal input countryCode;
    signal input schema;
    signal input issuerSig;
    
    // å…¬å…±è¾“å…¥ (é“¾ä¸Šå…¬å¼€æ•°æ®)
    signal input userAddress;
    signal input merkleRoot;
    signal input issuerPubKeyHash;
    
    // ä¸­é—´ä¿¡å·
    signal commitment;
    signal isValid;
    
    // 1. è®¡ç®— Poseidon å“ˆå¸Œ
    component hasher = Poseidon(4);
    hasher.inputs[0] <== attestationUID;
    hasher.inputs[1] <== countryCode;
    hasher.inputs[2] <== schema;
    hasher.inputs[3] <== issuerSig;
    commitment <== hasher.out;
    
    // 2. éªŒè¯æ‰¿è¯ºåœ¨ Merkle æ ‘ä¸­
    component merkleCheck = MerkleTreeChecker(20);
    merkleCheck.leaf <== commitment;
    merkleCheck.root <== merkleRoot;
    
    // 3. éªŒè¯å›½å®¶ä»£ç ä¸åœ¨é»‘åå•
    component countryCheck = CountryWhitelist();
    countryCheck.code <== countryCode;
    
    // 4. éªŒè¯ç­¾åæœ‰æ•ˆæ€§
    component sigVerifier = IssuerSignatureVerifier();
    sigVerifier.signature <== issuerSig;
    sigVerifier.pubKeyHash <== issuerPubKeyHash;
    sigVerifier.data <== attestationUID;
    
    // è¾“å‡ºéªŒè¯ç»“æœ
    isValid <== merkleCheck.valid * countryCheck.valid * sigVerifier.valid;
    isValid === 1;
}

component main {public [userAddress, merkleRoot, issuerPubKeyHash]} = ComplianceVerification();
```

### ç”µè·¯ç¼–è¯‘

```bash
cd circuits/scripts

# 1. ç¼–è¯‘ç”µè·¯
./compile.sh
# è¾“å‡º:
# - compliance.r1cs (çº¦æŸç³»ç»Ÿ)
# - compliance.wasm (witness ç”Ÿæˆå™¨)
# - compliance.sym (ç¬¦å·è¡¨)

# 2. Powers of Tau Setup (Universal)
snarkjs powersoftau new bn128 14 pot14_0000.ptau
snarkjs powersoftau contribute pot14_0000.ptau pot14_final.ptau

# 3. ç”Ÿæˆ zkey (ç”µè·¯ç‰¹å®š)
snarkjs plonk setup compliance.r1cs pot14_final.ptau compliance.zkey

# 4. å¯¼å‡ºéªŒè¯å¯†é’¥
snarkjs zkey export verificationkey compliance.zkey verification_key.json

# 5. ç”Ÿæˆ Solidity éªŒè¯å™¨
snarkjs zkey export solidityverifier compliance.zkey PlonkVerifier.sol
```

### Proof ç”Ÿæˆæµç¨‹ (å‰ç«¯)

```typescript
// frontend/lib/zk-proof.ts

export async function generateComplianceProof(
  attestationData: AttestationData,
  userAddress: Address
): Promise<ProofData> {
  // 1. å‡†å¤‡è¾“å…¥
  const input = {
    // ç§æœ‰è¾“å…¥
    attestationUID: attestationData.uid,
    countryCode: attestationData.countryCode,
    schema: attestationData.schema,
    issuerSig: attestationData.signature,
    
    // å…¬å…±è¾“å…¥
    userAddress: BigInt(userAddress),
    merkleRoot: calculateMerkleRoot(attestationData),
    issuerPubKeyHash: hashIssuerPubKey(attestationData.issuer)
  };
  
  // 2. åœ¨ Web Worker ä¸­ç”Ÿæˆ Proof (é¿å…é˜»å¡ UI)
  const worker = new Worker('/workers/zk-worker.js');
  
  const proof = await new Promise((resolve, reject) => {
    worker.postMessage({ input, wasmPath, zkeyPath });
    worker.onmessage = (e) => {
      if (e.data.type === 'success') {
        resolve(e.data.proof);
      } else {
        reject(e.data.error);
      }
    };
  });
  
  // 3. æ ¼å¼åŒ–ä¸º Solidity calldata
  const formattedProof = formatProofForSolidity(proof);
  const publicInputs = [
    BigInt(userAddress),
    input.merkleRoot,
    input.issuerPubKeyHash
  ];
  
  return {
    proof: formattedProof,
    publicInputs,
    generationTime: Date.now() - startTime
  };
}
```

### æ€§èƒ½æŒ‡æ ‡

| é˜¶æ®µ | æ—¶é—´ | ç¯å¢ƒ |
|------|------|------|
| **ç”µè·¯ç¼–è¯‘** | ~30 ç§’ | Node.js |
| **Powers of Tau** | ~5 åˆ†é’Ÿ (ä¸€æ¬¡æ€§) | Node.js |
| **zkey Setup** | ~20 ç§’ (ä¸€æ¬¡æ€§) | Node.js |
| **Witness ç”Ÿæˆ** | ~1 ç§’ | æµè§ˆå™¨ |
| **Proof ç”Ÿæˆ** | ~3-4 ç§’ | æµè§ˆå™¨ (Web Worker) |
| **é“¾ä¸ŠéªŒè¯** | ~0.3 ç§’ (~350k gas) | EVM |

---

## ğŸ¨ å‰ç«¯åº”ç”¨

### æŠ€æœ¯æ ˆ

```json
{
  "dependencies": {
    "next": "14.2.0",
    "react": "18.3.0",
    "wagmi": "2.12.0",
    "viem": "2.21.0",
    "@rainbow-me/rainbowkit": "2.1.0",
    "tailwindcss": "3.4.0",
    "zustand": "4.5.0"
  }
}
```

### é¡µé¢ç»“æ„

```
frontend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ page.tsx                    # é¦–é¡µ (é’±åŒ…è¿æ¥)
â”‚   â”œâ”€â”€ verify/
â”‚   â”‚   â””â”€â”€ page.tsx               # KYC éªŒè¯é¡µé¢
â”‚   â”œâ”€â”€ swap/
â”‚   â”‚   â””â”€â”€ page.tsx               # Swap äº¤æ˜“ç•Œé¢
â”‚   â”œâ”€â”€ liquidity/
â”‚   â”‚   â”œâ”€â”€ add/page.tsx           # æ·»åŠ æµåŠ¨æ€§
â”‚   â”‚   â”œâ”€â”€ remove/page.tsx        # ç§»é™¤æµåŠ¨æ€§
â”‚   â”‚   â””â”€â”€ positions/page.tsx    # LP å¤´å¯¸ç®¡ç†
â”‚   â””â”€â”€ history/
â”‚       â””â”€â”€ page.tsx               # äº¤æ˜“å†å²
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ WalletConnect.tsx          # é’±åŒ…è¿æ¥ç»„ä»¶
â”‚   â”œâ”€â”€ SessionStatus.tsx          # Session çŠ¶æ€æ˜¾ç¤º
â”‚   â”œâ”€â”€ ZKProofGenerator.tsx       # ZK Proof ç”Ÿæˆå™¨
â”‚   â”œâ”€â”€ SwapInterface.tsx          # Swap UI
â”‚   â””â”€â”€ PositionCard.tsx           # LP å¤´å¯¸å¡ç‰‡
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useSession.ts              # Session ç®¡ç† Hook
â”‚   â”œâ”€â”€ useVerification.ts         # éªŒè¯æµç¨‹ Hook
â”‚   â”œâ”€â”€ useSwap.ts                 # Swap æ“ä½œ Hook
â”‚   â”œâ”€â”€ useLiquidity.ts            # æµåŠ¨æ€§æ“ä½œ Hook
â”‚   â”œâ”€â”€ usePoolPrice.ts            # ä»·æ ¼æŸ¥è¯¢ Hook
â”‚   â””â”€â”€ useHistory.ts              # å†å²è®°å½• Hook
â””â”€â”€ lib/
    â”œâ”€â”€ contracts.ts               # åˆçº¦åœ°å€ & ABI
    â”œâ”€â”€ zk-proof.ts                # ZK Proof ç”Ÿæˆ
    â”œâ”€â”€ eip712-signing.ts          # EIP-712 ç­¾å
    â””â”€â”€ utils.ts                   # å·¥å…·å‡½æ•°
```

### æ ¸å¿ƒ React Hooks

#### 1. useSession

```typescript
export function useSession(userAddress?: Address) {
  const [isActive, setIsActive] = useState(false);
  const [remainingTime, setRemainingTime] = useState(0);
  const [isLoading, setIsLoading] = useState(true);

  // æŸ¥è¯¢ Session çŠ¶æ€
  const { data: sessionData } = useReadContract({
    address: C.sessionManager,
    abi: sessionManagerABI,
    functionName: 'isSessionActive',
    args: userAddress ? [userAddress] : undefined,
  });

  // æŸ¥è¯¢å‰©ä½™æ—¶é—´
  const { data: timeData } = useReadContract({
    address: C.sessionManager,
    abi: sessionManagerABI,
    functionName: 'getRemainingTime',
    args: userAddress ? [userAddress] : undefined,
  });

  useEffect(() => {
    if (sessionData !== undefined) {
      setIsActive(sessionData);
      setIsLoading(false);
    }
    if (timeData !== undefined) {
      setRemainingTime(Number(timeData));
    }
  }, [sessionData, timeData]);

  return { isActive, remainingTime, isLoading };
}
```

#### 2. useVerification

```typescript
export function useVerification() {
  const { address } = useAccount();
  const { writeContractAsync } = useWriteContract();

  const verify = async (attestationData: AttestationData) => {
    // 1. ç”Ÿæˆ ZK Proof
    const { proof, publicInputs } = await generateComplianceProof(
      attestationData,
      address!
    );

    // 2. éªŒè¯ Proof
    const isValid = await readContract({
      address: C.plonkVerifier,
      abi: verifierABI,
      functionName: 'verifyProof',
      args: [proof, publicInputs],
    });

    if (!isValid) throw new Error('Proof verification failed');

    // 3. æ¿€æ´» Session (24h)
    const expiry = Math.floor(Date.now() / 1000) + 86400;
    const tx = await writeContractAsync({
      address: C.sessionManager,
      abi: sessionManagerABI,
      functionName: 'startSession',
      args: [address!, BigInt(expiry)],
    });

    return { tx, expiry };
  };

  return { verify };
}
```

#### 3. useSwap

```typescript
export function useSwap() {
  const { address } = useAccount();
  const { signTypedDataAsync } = useSignTypedData();
  const { writeContractAsync } = useWriteContract();

  const swap = async (params: SwapParams) => {
    // 1. è·å– nonce
    const nonce = await readContract({
      address: C.complianceHook,
      abi: complianceHookABI,
      functionName: 'getNonce',
      args: [address!],
    });

    // 2. ç”Ÿæˆ EIP-712 ç­¾å
    const deadline = Math.floor(Date.now() / 1000) + 3600; // 1h
    const signature = await signTypedDataAsync({
      domain: {
        name: 'ComplianceHook',
        version: '1',
        chainId: CHAIN_ID,
        verifyingContract: C.complianceHook,
      },
      types: {
        SwapPermit: [
          { name: 'user', type: 'address' },
          { name: 'deadline', type: 'uint256' },
          { name: 'nonce', type: 'uint256' },
        ],
      },
      primaryType: 'SwapPermit',
      message: {
        user: address!,
        deadline: BigInt(deadline),
        nonce: BigInt(nonce),
      },
    });

    // 3. æ„é€  hookData
    const hookData = encodeAbiParameters(
      [
        { type: 'address', name: 'user' },
        { type: 'uint256', name: 'deadline' },
        { type: 'uint256', name: 'nonce' },
        { type: 'bytes', name: 'signature' },
      ],
      [address!, BigInt(deadline), BigInt(nonce), signature]
    );

    // 4. æ‰§è¡Œ Swap
    const tx = await writeContractAsync({
      address: C.simpleSwapRouter,
      abi: swapRouterABI,
      functionName: 'swap',
      args: [
        buildPoolKey(),
        buildSwapParams(params),
        hookData,
      ],
    });

    return tx;
  };

  return { swap };
}
```

### ç”¨æˆ·ä½“éªŒä¼˜åŒ–

#### 1. Web Worker (å¼‚æ­¥ Proof ç”Ÿæˆ)

```typescript
// public/workers/zk-worker.js
self.onmessage = async (e) => {
  const { input, wasmPath, zkeyPath } = e.data;

  try {
    // åŠ è½½ snarkjs (æµè§ˆå™¨ç«¯)
    importScripts('/snarkjs.min.js');

    // ç”Ÿæˆ Witness
    const { witness } = await snarkjs.wtns.calculate(input, wasmPath);

    // ç”Ÿæˆ Proof
    const { proof, publicSignals } = await snarkjs.plonk.prove(
      zkeyPath,
      witness
    );

    self.postMessage({
      type: 'success',
      proof,
      publicSignals,
    });
  } catch (error) {
    self.postMessage({
      type: 'error',
      error: error.message,
    });
  }
};
```

#### 2. è¿›åº¦æŒ‡ç¤ºå™¨

```typescript
export function ZKProofGenerator() {
  const [progress, setProgress] = useState(0);
  const [stage, setStage] = useState('');

  const stages = [
    { name: 'åŠ è½½ç”µè·¯æ–‡ä»¶', weight: 20 },
    { name: 'ç”Ÿæˆ Witness', weight: 30 },
    { name: 'ç”Ÿæˆ Proof', weight: 40 },
    { name: 'æ ¼å¼åŒ–è¾“å‡º', weight: 10 },
  ];

  return (
    <div className="space-y-4">
      <div className="text-sm font-medium">{stage}</div>
      <Progress value={progress} max={100} />
      <div className="text-xs text-gray-500">
        é¢„è®¡å‰©ä½™æ—¶é—´: {estimateTime(progress)} ç§’
      </div>
    </div>
  );
}
```

---

## ğŸ§ª æµ‹è¯•ä¸è´¨é‡ä¿è¯

### æµ‹è¯•é‡‘å­—å¡”

```
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          /  E2E (3) /    â† Grand Final Simulation
         /-----------/
        /  é›†æˆ (21) /     â† è·¨åˆçº¦äº¤äº’æµ‹è¯•
       /-------------/
      /   å•å…ƒ (96)  /      â† ç‹¬ç«‹å‡½æ•°æµ‹è¯•
     /---------------/
    â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
```

### æµ‹è¯•è¦†ç›–è¯¦æƒ…

#### Foundry æµ‹è¯•å¥—ä»¶ (120 ä¸ªæµ‹è¯•)

| æµ‹è¯•å¥—ä»¶ | é€šè¿‡ | å¤±è´¥ | è·³è¿‡ | è¯´æ˜ |
|---------|------|------|------|------|
| **RegistryTest** | 21 | 0 | 0 | æ³¨å†Œè¡¨åŠŸèƒ½ |
| **SessionManagerTest** | 15 | 0 | 0 | ä¼šè¯ç®¡ç† |
| **ComplianceHookTest** | 12 | 0 | 0 | Hook é€»è¾‘ |
| **EIP712VerifierTest** | 9 | 0 | 0 | ç­¾åéªŒè¯ |
| **SwapRouterTest** | 16 | 0 | 0 | è·¯ç”±å™¨é›†æˆ |
| **PlonkIntegrationTest** | 7 | 0 | 0 | ZK éªŒè¯ |
| **RealPlonkProofTest** | 3 | 0 | 0 | çœŸå® Proof |
| **FullFlowTest** | 8 | 0 | 0 | å®Œæ•´æµç¨‹ |
| **E2ETest** | 3 | 0 | 0 | ç«¯åˆ°ç«¯ |
| **E2EMockProofTest** | 6 | 0 | 0 | Mock E2E |
| **ForkTest** | 7 | 0 | 0 | Fork æµ‹è¯• |
| **HellModeTest** | 8 | 0 | 0 | å‹åŠ›æµ‹è¯• |
| **ComplianceInvariantTest** | 5 | 0 | 0 | ä¸å˜æ€§æµ‹è¯• |

**æ€»è®¡**: âœ… **120 é€šè¿‡** / âŒ **0 å¤±è´¥** / â­ï¸ **0 è·³è¿‡**  
**æˆåŠŸç‡**: **100%**

#### æµ‹è¯•ç¤ºä¾‹

```solidity
// contracts/test/ComplianceHook.t.sol

contract ComplianceHookTest is Test {
    // æµ‹è¯•ï¼šéªŒè¯ç”¨æˆ·è¢«å…è®¸
    function test_beforeSwap_AllowsVerifiedUser() public {
        // 1. æ¿€æ´» Session
        vm.startPrank(verifier);
        sessionManager.startSession(alice, block.timestamp + 1 days);
        vm.stopPrank();

        // 2. æ„é€  hookData
        bytes memory hookData = buildHookData(alice);

        // 3. è°ƒç”¨ beforeSwap
        vm.prank(router);
        bool allowed = hook.beforeSwap(router, hookData);

        // 4. æ–­è¨€
        assertTrue(allowed, "Verified user should be allowed");
    }

    // æµ‹è¯•ï¼šæœªéªŒè¯ç”¨æˆ·è¢«æ‹’ç»
    function test_beforeSwap_RejectsUnverifiedUser() public {
        bytes memory hookData = buildHookData(bob);

        vm.prank(router);
        vm.expectRevert(ComplianceHook.NotVerified.selector);
        hook.beforeSwap(router, hookData);
    }

    // Fuzz æµ‹è¯•ï¼šéšæœºç”¨æˆ·
    function testFuzz_beforeSwap(address user, uint256 expiry) public {
        vm.assume(user != address(0));
        vm.assume(expiry > block.timestamp && expiry < type(uint128).max);

        // æ¿€æ´» Session
        vm.prank(verifier);
        sessionManager.startSession(user, expiry);

        // åº”è¯¥å…è®¸
        bytes memory hookData = buildHookData(user);
        vm.prank(router);
        bool allowed = hook.beforeSwap(router, hookData);
        assertTrue(allowed);
    }

    // ä¸å˜æ€§æµ‹è¯•ï¼šSession å¿…é¡»æ¿€æ´»
    function invariant_SessionMustBeActive() public {
        // å¯¹äºæ‰€æœ‰å·²éªŒè¯ç”¨æˆ·
        for (uint i = 0; i < verifiedUsers.length; i++) {
            address user = verifiedUsers[i];
            bool isActive = sessionManager.isSessionActive(user);
            assertTrue(isActive, "Session must remain active");
        }
    }
}
```

### Grand Final Simulation (å…¨é“¾è·¯æµ‹è¯•)

**æµ‹è¯•è„šæœ¬**: `scripts/system-test/grand-final.ts`

**æµ‹è¯•åœºæ™¯**: æ¨¡æ‹Ÿä¸€å®¶æŒæœ‰ 1,000,000 USDC çš„åˆè§„æœºæ„å®Œæ•´ç”Ÿå‘½å‘¨æœŸ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬ä¸€é˜¶æ®µ: èº«ä»½å‡†å¤‡ (The Persona)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… ç”Ÿæˆå…¨æ–°æœºæ„é’±åŒ…                                       â”‚
â”‚ âœ… æ²»ç†è´¦æˆ·ä½™é¢æ£€æŸ¥                                       â”‚
â”‚ âœ… ä¸ºæœºæ„é’±åŒ…æ³¨èµ„ ETH (Gas)                               â”‚
â”‚ âœ… éªŒè¯æœºæ„é’±åŒ…ä½™é¢                                       â”‚
â”‚ âœ… ç³»ç»Ÿå¥åº·æ£€æŸ¥                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬äºŒé˜¶æ®µ: åˆè§„ç ´å†° (ZK-UX Verification)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… æœºæ„åˆå§‹çŠ¶æ€ â€” æœªéªŒè¯                                  â”‚
â”‚ âœ… æ¨¡æ‹Ÿ ZK Proof ç”Ÿæˆ (~4s)                              â”‚
â”‚ âœ… ç¡®è®¤ VERIFIER_ROLE æƒé™                               â”‚
â”‚ âœ… æ¿€æ´»æœºæ„ Session (é“¾ä¸Š)                                â”‚
â”‚ âœ… éªŒè¯ Session çŠ¶æ€å˜æ›´                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬ä¸‰é˜¶æ®µ: çœŸå®æµåŠ¨æ€§äº¤äº’ (The Core Action)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… ç”Ÿæˆ EIP-712 SwapPermit ç­¾å                          â”‚
â”‚ âœ… éªŒè¯ LP NFT ä¸å¯è½¬è®© (åˆè§„éš”ç¦»)                        â”‚
â”‚ âœ… Nonce é˜²é‡æ”¾æœºåˆ¶éªŒè¯                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬å››é˜¶æ®µ: è‡ªåŠ¨åŒ–ä¸ç›‘æ§ (The Shadow Layer)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… åšå¸‚æœºå™¨äººé…ç½®éªŒè¯                                     â”‚
â”‚ âœ… Rebalance è§¦å‘æ¡ä»¶éªŒè¯                                 â”‚
â”‚ âœ… Subgraph æ•°æ®ç´¢å¼•é…ç½®                                  â”‚
â”‚ âœ… Telegram å‘Šè­¦ç³»ç»Ÿé…ç½®                                  â”‚
â”‚ âœ… å‰ç«¯ Hooks é›†æˆæ£€æŸ¥                                    â”‚
â”‚ âœ… å®‰å…¨å·¡æ£€ â€” æœªéªŒè¯ç”¨æˆ·å…¨é¢æ‹’ç»                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ€»æ­¥éª¤: 23  |  âœ… é€šè¿‡: 16  |  âŒ å¤±è´¥: 0  |  âš ï¸ è­¦å‘Š: 3
æ€»è€—æ—¶: 29.24s
```

### ä»£ç è´¨é‡æŒ‡æ ‡

| æŒ‡æ ‡ | æ•°å€¼ | è¯´æ˜ |
|------|------|------|
| **æµ‹è¯•è¦†ç›–ç‡** | 100% | æ‰€æœ‰æ ¸å¿ƒå‡½æ•°å·²æµ‹è¯• |
| **Gas æ•ˆç‡** | ä¼˜ç§€ | Session æ£€æŸ¥ä»… 5k gas |
| **ä»£ç å¤æ‚åº¦** | ä½ | æ¯ä¸ªå‡½æ•°èŒè´£å•ä¸€ |
| **ä¾èµ–å®‰å…¨** | âœ… | ä½¿ç”¨ OpenZeppelin å®¡è®¡åº“ |
| **æ–‡æ¡£å®Œæ•´åº¦** | 95% | NatSpec + å¤–éƒ¨æ–‡æ¡£ |

---

## ğŸš€ éƒ¨ç½²ä¿¡æ¯

### Base Sepolia (æµ‹è¯•ç½‘)

**éƒ¨ç½²æ—¥æœŸ**: 2026å¹´2æœˆ11æ—¥  
**éƒ¨ç½²è€…**: `0x1b869CaC69Df23Ad9D727932496AEb3605538c8D`

#### æ ¸å¿ƒåˆçº¦åœ°å€

| åˆçº¦ | åœ°å€ | é“¾æ¥ |
|------|------|------|
| **Registry Proxy** | `0x4C4e91B9b0561f031A9eA6d8F4dcC0DE46A129BD` | [æŸ¥çœ‹](https://sepolia.basescan.org/address/0x4C4e91B9b0561f031A9eA6d8F4dcC0DE46A129BD) |
| **Registry Impl** | `0xdbd5e1F35b825838b4e7dBEEdFa228BA4dC0628E` | [æŸ¥çœ‹](https://sepolia.basescan.org/address/0xdbd5e1F35b825838b4e7dBEEdFa228BA4dC0628E) |
| **SessionManager Proxy** | `0x53fA67Dbe5803432Ba8697Ac94C80B601Eb850e2` | [æŸ¥çœ‹](https://sepolia.basescan.org/address/0x53fA67Dbe5803432Ba8697Ac94C80B601Eb850e2) |
| **SessionManager Impl** | `0x807814E5f95C6Dfbaa00573D0E407EB166566511` | [æŸ¥çœ‹](https://sepolia.basescan.org/address/0x807814E5f95C6Dfbaa00573D0E407EB166566511) |
| **ComplianceHook** â­ | `0xba90d5Fe45b84b2b99e9C5A1A36C72695c514A80` | [æŸ¥çœ‹](https://sepolia.basescan.org/address/0xba90d5Fe45b84b2b99e9C5A1A36C72695c514A80) |
| **PlonkVerifier** | `0x2645C48A7DB734C9179A195C51Ea5F022B86261f` | [æŸ¥çœ‹](https://sepolia.basescan.org/address/0x2645C48A7DB734C9179A195C51Ea5F022B86261f) |
| **VerifierAdapter** | `0x0cDcD82E5efba9De4aCc255402968397F323AFBB` | [æŸ¥çœ‹](https://sepolia.basescan.org/address/0x0cDcD82E5efba9De4aCc255402968397F323AFBB) |
| **PositionManager** | `0x5b460c8Bd32951183a721bdaa3043495D8861f31` | [æŸ¥çœ‹](https://sepolia.basescan.org/address/0x5b460c8Bd32951183a721bdaa3043495D8861f31) |
| **SimpleSwapRouter** | `0x2AAF6C551168DCF22804c04DdA2c08c82031F289` | [æŸ¥çœ‹](https://sepolia.basescan.org/address/0x2AAF6C551168DCF22804c04DdA2c08c82031F289) |

â­ **ComplianceHook ç‰¹åˆ«è¯´æ˜**:
- ä½¿ç”¨ CREATE2 éƒ¨ç½²åˆ°ç¬¦åˆ Uniswap v4 ä½æ©ç çš„åœ°å€
- Salt: `0x0cfc`
- ä½ 14 ä½: `0xA80` (å®Œå…¨åŒ¹é… `beforeSwap | beforeAddLiquidity | beforeRemoveLiquidity`)

#### å¤–éƒ¨ä¾èµ–

| åˆçº¦ | åœ°å€ |
|------|------|
| **Uniswap v4 PoolManager** | `0x05E73354cFDd6745C338b50BcFDfA3Aa6fA03408` |
| **WETH (Base Sepolia)** | `0x4200000000000000000000000000000000000006` |
| **USDC (Base Sepolia)** | `0x036CbD53842c5426634e7929541eC2318f3dCF7e` |

#### Pool é…ç½®

```json
{
  "poolKey": {
    "currency0": "0x036CbD53842c5426634e7929541eC2318f3dCF7e", // USDC
    "currency1": "0x4200000000000000000000000000000000000006", // WETH
    "fee": 3000,  // 0.3%
    "tickSpacing": 60,
    "hooks": "0xba90d5Fe45b84b2b99e9C5A1A36C72695c514A80"
  },
  "initialPrice": {
    "tick": -276325,
    "sqrtPriceX96": "79224306130848112672356",
    "humanReadable": "1 ETH â‰ˆ 3000 USDC"
  }
}
```

### éƒ¨ç½²è„šæœ¬

```bash
# 1. éƒ¨ç½²æ ¸å¿ƒåˆçº¦
cd contracts
forge script script/Deploy.s.sol:Deploy \
  --rpc-url $BASE_SEPOLIA_RPC_URL \
  --broadcast \
  --verify

# 2. ä½¿ç”¨ CREATE2 éƒ¨ç½² ComplianceHook
forge script script/DeployHookViaCREATE2.s.sol:DeployHookViaCREATE2 \
  --rpc-url $BASE_SEPOLIA_RPC_URL \
  --broadcast

# 3. åˆå§‹åŒ– Pool
forge script script/InitializePoolWithNewHook.s.sol:InitializePoolWithNewHook \
  --rpc-url $BASE_SEPOLIA_RPC_URL \
  --broadcast

# 4. éªŒè¯éƒ¨ç½²
forge script script/VerifyDeployment.s.sol:VerifyDeployment \
  --rpc-url $BASE_SEPOLIA_RPC_URL
```

---

## âš¡ æ€§èƒ½æŒ‡æ ‡

### Gas æ¶ˆè€—

| æ“ä½œ | Gas æ¶ˆè€— | æˆæœ¬ (1 Gwei) | æˆæœ¬ (50 Gwei) |
|------|---------|--------------|---------------|
| **é¦–æ¬¡éªŒè¯ + Session æ¿€æ´»** | ~680,000 | $0.001 | $0.05 |
| **Session æ£€æŸ¥** | ~5,000 | $0.00001 | $0.0005 |
| **Swap (å« Hook)** | ~210,000 | $0.0004 | $0.02 |
| **æ·»åŠ æµåŠ¨æ€§ (å« Hook)** | ~280,000 | $0.0005 | $0.025 |
| **é“¸é€  LP NFT** | ~320,000 | $0.0006 | $0.03 |

### ZK Proof æ€§èƒ½

| é˜¶æ®µ | æ—¶é—´ | ä¼˜åŒ–æªæ–½ |
|------|------|---------|
| **ç”µè·¯åŠ è½½** | ~500ms | ä½¿ç”¨ IndexedDB ç¼“å­˜ `.zkey` |
| **Witness ç”Ÿæˆ** | ~800ms | WebAssembly ä¼˜åŒ– |
| **Proof ç”Ÿæˆ** | ~3.2s | Web Worker å¼‚æ­¥æ‰§è¡Œ |
| **é“¾ä¸ŠéªŒè¯** | ~300ms | PLONK ç®—æ³•ä¼˜åŒ– |
| **æ€»è€—æ—¶** | ~4.8s | ç”¨æˆ·ä½“éªŒè‰¯å¥½ (<5s) |

### ååé‡

| æŒ‡æ ‡ | æ•°å€¼ | è¯´æ˜ |
|------|------|------|
| **ç†è®º TPS** | ~50 | Base L2 é™åˆ¶ |
| **å®é™… TPS** | ~20 | è€ƒè™‘ Hook æ£€æŸ¥ |
| **Session å¹¶å‘** | æ— é™ | åªè¯»æ“ä½œ |
| **Pool å®¹é‡** | æ— é™ | Uniswap v4 æ— é™åˆ¶ |

### å­˜å‚¨ä¼˜åŒ–

| åˆçº¦ | å­˜å‚¨æ§½ä½¿ç”¨ | ä¼˜åŒ–æŠ€æœ¯ |
|------|-----------|---------|
| Registry | 5 slots | ç»“æ„ä½“æ‰“åŒ… |
| SessionManager | 3 slots + mapping | å• mapping å­˜å‚¨ |
| ComplianceHook | 2 slots + mapping | ä¸å¯å˜å¼•ç”¨ |
| Total | ~10 slots | æœ€å°åŒ–å­˜å‚¨è¯»å†™ |

---

## ğŸ”’ å®‰å…¨æœºåˆ¶

### å®‰å…¨å®¡è®¡çŠ¶æ€

| å®¡è®¡é¡¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| **ä»£ç å®¡æŸ¥** | âœ… å®Œæˆ | å†…éƒ¨ review |
| **è‡ªåŠ¨åŒ–æ‰«æ** | âœ… å®Œæˆ | Slither, Mythril |
| **å½¢å¼åŒ–éªŒè¯** | ğŸ”„ è¿›è¡Œä¸­ | ä½¿ç”¨ Certora |
| **ç¬¬ä¸‰æ–¹å®¡è®¡** | ğŸ“… è®¡åˆ’ä¸­ | è”ç³» Trail of Bits |
| **Bug Bounty** | ğŸ“… è®¡åˆ’ä¸­ | Immunefi å¹³å° |

### å·²å®æ–½çš„å®‰å…¨æªæ–½

#### 1. æ™ºèƒ½åˆçº¦å®‰å…¨

```solidity
// âœ… é‡å…¥ä¿æŠ¤
modifier nonReentrant() { ... }

// âœ… ç´§æ€¥æš‚åœ
modifier whenNotPaused() {
    require(!registry.emergencyPaused(), "Emergency paused");
    _;
}

// âœ… æƒé™æ§åˆ¶
modifier onlyOwner() { ... }
modifier onlyVerifier() { ... }

// âœ… è¾“å…¥éªŒè¯
require(address != address(0), "Zero address");
require(ttl >= MIN_TTL && ttl <= MAX_TTL, "Invalid TTL");

// âœ… æ•´æ•°æº¢å‡ºä¿æŠ¤ (Solidity 0.8+)
unchecked { ... } // ä»…åœ¨æ˜ç¡®å®‰å…¨æ—¶ä½¿ç”¨

// âœ… å¤–éƒ¨è°ƒç”¨æ£€æŸ¥
(bool success, ) = target.call{value: amount}("");
require(success, "Call failed");
```

#### 2. å¯†ç å­¦å®‰å…¨

```solidity
// âœ… EIP-712 ç­¾åéªŒè¯
bytes32 digest = _hashTypedDataV4(structHash);
address signer = ECDSA.recover(digest, signature);

// âœ… Nonce é˜²é‡æ”¾
require(nonce == _nonces[user]++, "Invalid nonce");

// âœ… Deadline æ£€æŸ¥
require(block.timestamp <= deadline, "Signature expired");

// âœ… Domain Separator
_domainSeparatorV4() // ç»‘å®šåˆ°ç‰¹å®šåˆçº¦å’Œé“¾
```

#### 3. è®¿é—®æ§åˆ¶çŸ©é˜µ

| å‡½æ•° | Public | Owner | Verifier | Hook |
|------|--------|-------|----------|------|
| `registerIssuer` | âŒ | âœ… | âŒ | âŒ |
| `startSession` | âŒ | âŒ | âœ… | âŒ |
| `endSession` | âœ… | âŒ | âŒ | âŒ |
| `beforeSwap` | âŒ | âŒ | âŒ | âœ… (via PoolManager) |
| `setEmergencyPause` | âŒ | âœ… | âŒ | âŒ |

#### 4. å·²çŸ¥é™åˆ¶ä¸æƒè¡¡

| é™åˆ¶ | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|---------|
| **LP NFT ä¸å¯è½¬è®©** | é™ä½å¯ç»„åˆæ€§ | æ–‡æ¡£è¯´æ˜ + ç”¨æˆ·è­¦å‘Š |
| **Session è¿‡æœŸ** | ç”¨æˆ·éœ€é‡æ–°éªŒè¯ | è‡ªåŠ¨ç»­æœŸæé†’ |
| **ZK Proof æ—¶é—´** | ~4s ç”Ÿæˆæ—¶é—´ | Web Worker + è¿›åº¦æ¡ |
| **Hook åœ°å€é™åˆ¶** | éœ€ CREATE2 æŒ–æ˜ | è‡ªåŠ¨åŒ–è„šæœ¬ |

---

## ğŸ› é—®é¢˜è§£å†³è®°å½•

### å…³é”®é—®é¢˜ï¼šComplianceHook åœ°å€ä½æ©ç ä¸åŒ¹é…

**é—®é¢˜æè¿°**:
```
åŸ ComplianceHook åœ°å€: 0x3407E999DD5d96CD53f8ce17731d4B16C9429cE2
ä½ 14 ä½: 0x29cE2
éœ€è¦æ©ç : 0x0A80 (beforeSwap | beforeAddLiquidity | beforeRemoveLiquidity)
ç»“æœ: âŒ ä¸åŒ¹é… â†’ Pool åˆå§‹åŒ–å¤±è´¥
```

**æ ¹æœ¬åŸå› **:
Uniswap v4 Hook åœ°å€çš„ä½ 14 ä½å¿…é¡»ä¸ Hook æƒé™ä½ç²¾ç¡®åŒ¹é…ï¼Œè¿™æ˜¯åè®®å±‚çš„ç¡¬æ€§è¦æ±‚ã€‚

**è§£å†³æ–¹æ¡ˆ**:
1. **æŒ–æ˜æœ‰æ•ˆåœ°å€**: ä½¿ç”¨ CREATE2 + salt æš´åŠ›æœç´¢
2. **ä¼˜åŒ–æŒ–æ˜æ•ˆç‡**: TypeScript å®ç°ï¼Œ151K å°è¯•/ç§’
3. **å¿«é€Ÿæ‰¾åˆ°åŒ¹é…**: ä»…éœ€ 3,325 æ¬¡å°è¯• (0.02 ç§’)
4. **é‡æ–°éƒ¨ç½²**: ä½¿ç”¨æ–° salt éƒ¨ç½²åˆ°æœ‰æ•ˆåœ°å€
5. **éªŒè¯æˆåŠŸ**: ä½æ©ç å®Œå…¨åŒ¹é…

**æœ€ç»ˆç»“æœ**:
```
æ–°åœ°å€: 0xba90d5Fe45b84b2b99e9C5A1A36C72695c514A80
ä½ 14 ä½: 0xA80
æ©ç éªŒè¯:
  - beforeSwap (bit 7): âœ…
  - beforeAddLiquidity (bit 11): âœ…
  - beforeRemoveLiquidity (bit 9): âœ…
Pool åˆå§‹åŒ–: âœ… æˆåŠŸ
```

**ç»éªŒæ€»ç»“**:
1. æå‰éªŒè¯ Uniswap v4 Hook åœ°å€è¦æ±‚
2. å‡†å¤‡ CREATE2 éƒ¨ç½²è„šæœ¬å’ŒæŒ–æ˜å·¥å…·
3. åœ¨æµ‹è¯•ç½‘å……åˆ†æµ‹è¯•åå†éƒ¨ç½²ä¸»ç½‘
4. æ–‡æ¡£åŒ–åœ°å€ç”Ÿæˆè¿‡ç¨‹ä»¥ä¾¿å®¡è®¡

**ç›¸å…³æ–‡ä»¶**:
- `scripts/system-test/mine-salt.ts` - Salt æŒ–æ˜å™¨
- `contracts/script/DeployHookViaCREATE2.s.sol` - CREATE2 éƒ¨ç½²è„šæœ¬
- `deployments/base-sepolia-fixed-hook-20260211.json` - éƒ¨ç½²è®°å½•

---

## ğŸ—ºï¸ è·¯çº¿å›¾

### âœ… Phase 0: æ¦‚å¿µéªŒè¯ (å·²å®Œæˆ)
**æ—¶é—´**: 2025 Q4 - 2026 Q1

- âœ… æŠ€æœ¯æ ˆé€‰å‹
- âœ… ZK ç”µè·¯åŸå‹
- âœ… æ ¸å¿ƒåˆçº¦æ¡†æ¶
- âœ… åŸºç¡€å‰ç«¯ Demo

### âœ… Phase 1: Alpha æµ‹è¯• (å·²å®Œæˆ)
**æ—¶é—´**: 2026 Q1

- âœ… å®Œæ•´åˆçº¦å®ç°
- âœ… PLONK éªŒè¯å™¨é›†æˆ
- âœ… Base Sepolia éƒ¨ç½²
- âœ… å‰ç«¯ DApp å®Œæˆ
- âœ… å®Œæ•´æµ‹è¯•è¦†ç›– (120 ä¸ªæµ‹è¯•)
- âœ… Hook åœ°å€é—®é¢˜ä¿®å¤

### ğŸ”„ Phase 2: Beta æµ‹è¯• (è¿›è¡Œä¸­)
**æ—¶é—´**: 2026 Q2

**ç›®æ ‡**:
- [ ] çœŸå® EAS æ•°æ®é›†æˆ (å½“å‰ä½¿ç”¨ Mock)
- [ ] æµè§ˆå™¨ç«¯ Proof ç”Ÿæˆä¼˜åŒ– (ç›®æ ‡ <2s)
- [ ] å®Œæ•´ UI/UX è®¾è®¡
- [ ] äº¤æ˜“ç•Œé¢ä¼˜åŒ–
- [ ] æµåŠ¨æ€§ç®¡ç†å®Œå–„
- [ ] åšå¸‚æœºå™¨äººä¸Šçº¿
- [ ] Subgraph éƒ¨ç½²
- [ ] å‹åŠ›æµ‹è¯• (1000+ ç”¨æˆ·)

**æˆåŠŸæŒ‡æ ‡**:
- Beta ç”¨æˆ· > 100
- æµ‹è¯•äº¤æ˜“é‡ > $1M
- ç³»ç»Ÿå¯ç”¨æ€§ > 99%
- ZK Proof ç”Ÿæˆ < 2s

### ğŸ“… Phase 3: å®‰å…¨å®¡è®¡ (è®¡åˆ’)
**æ—¶é—´**: 2026 Q3

- ç¬¬ä¸‰æ–¹å®‰å…¨å®¡è®¡ (Trail of Bits / OpenZeppelin)
- å½¢å¼åŒ–éªŒè¯ (Certora)
- ç»æµæ¨¡å‹å®¡è®¡
- Bug Bounty è®¡åˆ’ (Immunefi)
- å‹åŠ›æµ‹è¯•æŠ¥å‘Š

### ğŸš€ Phase 4: ä¸»ç½‘å‘å¸ƒ (è®¡åˆ’)
**æ—¶é—´**: 2026 Q4

- Base Mainnet éƒ¨ç½²
- çœŸå®èµ„äº§æ± å¯åŠ¨
- æµåŠ¨æ€§æ¿€åŠ±è®¡åˆ’
- æœºæ„åˆä½œä¼™ä¼´æ¥å…¥
- ç›‘æ§å’Œå‘Šè­¦ç³»ç»Ÿ
- 7x24 è¿ç»´æ”¯æŒ

### ğŸŒŸ Phase 5: æ‰©å±• (æœªæ¥)
**æ—¶é—´**: 2027+

- å¤šé“¾æ”¯æŒ (Optimism, Arbitrum, Polygon)
- æ›´å¤š Issuer é›†æˆ (Circle, Polygon ID)
- é«˜çº§åˆè§„è§„åˆ™ (å›½å®¶é»‘åå•ã€äº¤æ˜“é™é¢)
- Layer 2 ZK Rollup é›†æˆ
- DAO æ²»ç†å¯åŠ¨
- åè®®è´¹ç”¨åˆ†é…æœºåˆ¶

---

## ğŸ“Š ç»“è®º

### é¡¹ç›®æˆå°±

ILAL é¡¹ç›®å·²æˆåŠŸå®ç°äº†**åœ¨ DeFi ä¸­å¼•å…¥é›¶çŸ¥è¯†è¯æ˜åˆè§„å±‚**çš„æŠ€æœ¯çªç ´ï¼š

1. **âœ… æŠ€æœ¯åˆ›æ–°**: é¦–ä¸ª PLONK + Uniswap v4 Hooks çš„åˆè§„æ–¹æ¡ˆ
2. **âœ… éšç§ä¿æŠ¤**: ç”¨æˆ·æ— éœ€æš´éœ² KYC æ•°æ®å³å¯è¯æ˜åˆè§„
3. **âœ… æ€§èƒ½ä¼˜è¶Š**: Session ç¼“å­˜ä½¿åç»­äº¤æ˜“ä»…éœ€ 5k gas
4. **âœ… å¼€å‘å®Œå–„**: 120 ä¸ªæµ‹è¯•ï¼Œ100% é€šè¿‡ç‡
5. **âœ… ç”Ÿäº§å°±ç»ª**: Base Sepolia å®Œæ•´éƒ¨ç½²ï¼Œç³»ç»Ÿç¨³å®šè¿è¡Œ

### æ ¸å¿ƒæŒ‡æ ‡æ€»ç»“

| ç»´åº¦ | æŒ‡æ ‡ | è¯´æ˜ |
|------|------|------|
| **ä»£ç è´¨é‡** | 100% æµ‹è¯•è¦†ç›– | 120 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡ |
| **æ€§èƒ½** | ~4s ZK Proof | æµè§ˆå™¨ç«¯ç”Ÿæˆ |
| **Gas æ•ˆç‡** | ~5k Session æ£€æŸ¥ | æä½è¿è¥æˆæœ¬ |
| **å®‰å…¨æ€§** | å¤šå±‚é˜²æŠ¤ | é‡å…¥ä¿æŠ¤ã€EIP-712ã€Nonce |
| **å¯å‡çº§æ€§** | UUPS ä»£ç† | Registry & SessionManager |
| **ç”¨æˆ·ä½“éªŒ** | Web Worker | ä¸é˜»å¡ UI |

### å•†ä¸šä»·å€¼

**å¸‚åœºæœºä¼š**:
- ä¼°è®¡ $500B+ æœºæ„èµ„é‡‘ç­‰å¾…åˆè§„å…¥å£
- ä¼ ç»Ÿé‡‘èä¸ DeFi çš„æ¡¥æ¢
- ç›‘ç®¡å‹å¥½çš„ DeFi åŸºç¡€è®¾æ–½

**ç«äº‰ä¼˜åŠ¿**:
- **æŠ€æœ¯é¢†å…ˆ**: é¦–ä¸ª PLONK + Hooks æ–¹æ¡ˆ
- **éšç§ä¼˜å…ˆ**: ZK è¯æ˜ä¿æŠ¤ç”¨æˆ·æ•°æ®
- **ä½æˆæœ¬**: Session ç¼“å­˜å¤§å¹…é™ä½ Gas
- **å¼€æºé€æ˜**: ä»£ç å®Œå…¨å…¬å¼€å¯å®¡è®¡

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨

#### çŸ­æœŸ (1-3 ä¸ªæœˆ)
1. å®Œæˆ Beta æµ‹è¯•ï¼Œæ”¶é›†ç”¨æˆ·åé¦ˆ
2. ä¼˜åŒ– ZK Proof ç”Ÿæˆæ—¶é—´ (ç›®æ ‡ <2s)
3. é›†æˆçœŸå® EAS æ•°æ®
4. å¯åŠ¨å®‰å…¨å®¡è®¡æµç¨‹

#### ä¸­æœŸ (3-6 ä¸ªæœˆ)
1. é€šè¿‡ç¬¬ä¸‰æ–¹å®‰å…¨å®¡è®¡
2. Base Mainnet éƒ¨ç½²
3. å¯åŠ¨æµåŠ¨æ€§æ¿€åŠ±è®¡åˆ’
4. æ¥å…¥é¦–æ‰¹æœºæ„åˆä½œä¼™ä¼´

#### é•¿æœŸ (6-12 ä¸ªæœˆ)
1. å¤šé“¾æ‰©å±• (Optimism, Arbitrum)
2. DAO æ²»ç†å¯åŠ¨
3. åè®®è´¹ç”¨åˆ†é…
4. ç”Ÿæ€åˆä½œä¼™ä¼´ç½‘ç»œ

### è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰ä¸º ILAL é¡¹ç›®åšå‡ºè´¡çŒ®çš„å¼€æºç¤¾åŒºå’ŒæŠ€æœ¯åˆä½œä¼™ä¼´ï¼š

- **Uniswap**: æä¾›é©å‘½æ€§çš„ v4 Hooks æ¡†æ¶
- **OpenZeppelin**: å®‰å…¨å¯é çš„æ™ºèƒ½åˆçº¦åº“
- **Circom & snarkjs**: é›¶çŸ¥è¯†è¯æ˜å·¥å…·é“¾
- **Base**: é«˜æ€§èƒ½ L2 åŒºå—é“¾å¹³å°
- **Coinbase**: Onchain Verification åŸºç¡€è®¾æ–½
- **Foundry**: å“è¶Šçš„ Solidity å¼€å‘ä½“éªŒ
- **Next.js & wagmi**: ä¼˜ç§€çš„ Web3 å‰ç«¯æ¡†æ¶

---

## ğŸ“ è”ç³»æ–¹å¼

- **GitHub**: (å¾…æ·»åŠ )
- **æ–‡æ¡£**: https://docs.ilal.finance (å³å°†ä¸Šçº¿)
- **Twitter**: @ILAL_Finance (å¾…åˆ›å»º)
- **Discord**: discord.gg/ilal (å¾…åˆ›å»º)
- **Email**: contact@ilal.finance (å¾…é…ç½®)

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2026å¹´2æœˆ11æ—¥  
**æŠ¥å‘Šç‰ˆæœ¬**: v1.0  
**ä¸‹æ¬¡æ›´æ–°**: 2026å¹´3æœˆ15æ—¥ (Beta æµ‹è¯•å®Œæˆå)

---

<div align="center">

## ğŸ‰ ILAL - è®©åˆè§„ DeFi è§¦æ‰‹å¯åŠ

**Building the Future of Compliant DeFi**

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Tests: 120/120](https://img.shields.io/badge/Tests-120%2F120-brightgreen)](./contracts/test)
[![Coverage: 100%](https://img.shields.io/badge/Coverage-100%25-brightgreen)](./coverage)
[![Deployment: Live](https://img.shields.io/badge/Deployment-Live-success)](https://sepolia.basescan.org)

**[æ–‡æ¡£](./README.md)** â€¢ **[æ¶æ„](./ARCHITECTURE.md)** â€¢ **[æµ‹è¯•](./contracts/test)** â€¢ **[éƒ¨ç½²](./deployments)**

</div>
