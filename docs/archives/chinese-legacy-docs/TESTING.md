# 🎨 ILAL 前端 UI 测试指南

## 📋 UI 测试清单

### 🔥 地狱级 UI 测试 (7 项)

#### 1. ZK 生成性能测试 ⚡

**目标**: 低配电脑 Proof 生成 < 30 秒

##### 测试设备要求
- **低配**: 5 年前的笔记本（i5/8GB RAM）
- **中配**: 3 年前的设备（i7/16GB RAM）
- **高配**: 最新设备（M1/M2/i9/32GB RAM）

##### 测试步骤

1. **准备测试环境**
   ```bash
   cd frontend
   npm install
   npm run dev
   ```

2. **打开浏览器性能监控**
   - Chrome DevTools → Performance
   - 点击 "Record" 开始记录

3. **执行验证流程**
   - 连接钱包
   - 点击 "开始验证"
   - 观察 ZK Proof 生成时间

4. **记录结果**
   
   | 设备 | CPU | RAM | Proof 生成时间 | 通过/失败 |
   |------|-----|-----|---------------|----------|
   | 低配 | i5-7200U | 8GB | __秒 | ⏳ |
   | 中配 | i7-10750H | 16GB | __秒 | ⏳ |
   | 高配 | M1 Pro | 32GB | __秒 | ⏳ |

5. **通过标准**
   - ✅ 低配 < 30 秒
   - ✅ 中配 < 20 秒  
   - ✅ 高配 < 15 秒

##### 性能优化检查点

- [ ] Web Worker 正确运行（不阻塞主线程）
- [ ] 显示 Loading 动画
- [ ] 显示进度百分比 (0% → 100%)
- [ ] `.zkey` 文件已缓存（IndexedDB）
- [ ] 第二次验证更快（缓存生效）

---

#### 2. 钱包兼容性测试 👛

##### 2.1 MetaMask 测试 🦊

**优先级**: ⭐⭐⭐ 高

**测试流程**:

- [ ] **连接钱包**
  - 点击 "连接钱包"
  - 选择 MetaMask
  - 授权连接
  - ✅ 地址正确显示

- [ ] **网络切换**
  - 确认当前在 Base Mainnet
  - 尝试切换到其他链 → 应提示切回 Base
  - ✅ 网络切换提示正确

- [ ] **签名验证**
  - 点击 "开始验证"
  - MetaMask 弹出签名请求
  - 签名后 ZK Proof 生成
  - ✅ 签名成功，Session 激活

- [ ] **交易执行**
  - 进入交易界面
  - 输入交易参数
  - 点击 "交易"
  - MetaMask 弹出确认
  - ✅ 交易成功，Gas 预估准确

- [ ] **错误处理**
  - 拒绝签名 → ✅ 显示友好错误提示
  - 余额不足 → ✅ 显示 Gas 不足提示
  - 网络错误 → ✅ 提示重试

##### 2.2 Coinbase Wallet 测试 🔵

**优先级**: ⭐⭐⭐⭐⭐ 最高（Base 生态核心钱包）

**测试流程**:

- [ ] **移动端测试（重要）**
  - 在手机上打开 Coinbase Wallet 浏览器
  - 访问 ILAL DApp
  - ✅ UI 适配移动端
  - ✅ 按钮大小合适
  - ✅ 交互流畅

- [ ] **桌面端测试**
  - 安装 Coinbase Wallet 扩展
  - 连接钱包
  - ✅ 连接成功

- [ ] **Coinbase Verifications 集成**
  - 检查用户是否完成 Coinbase 验证
  - ✅ 显示验证状态
  - ✅ 引导用户完成验证（如未完成）

- [ ] **Session 管理**
  - 验证并激活 Session
  - ✅ Session 状态显示
  - ✅ 过期时间倒计时

- [ ] **交易测试**
  - Swap 交易
  - 添加流动性
  - 移除流动性
  - ✅ 所有操作成功

##### 2.3 Rainbow Wallet 测试 🌈

**优先级**: ⭐⭐ 中

**测试流程**:

- [ ] **RainbowKit 集成**
  - RainbowKit 弹窗正确显示
  - ✅ Rainbow Wallet 出现在选项中
  
- [ ] **连接测试**
  - 选择 Rainbow
  - 扫码连接（移动端）
  - ✅ 连接成功

- [ ] **基础交易**
  - 签名验证
  - 执行 Swap
  - ✅ 交易成功

---

#### 3. UI/UX 交互测试 🎨

##### 3.1 验证流程 UI

**页面**: `/` (首页)

- [ ] **初始状态**
  - ✅ 显示 "欢迎使用 ILAL"
  - ✅ 显示 "连接钱包" 按钮
  - ✅ 三步验证流程说明清晰

- [ ] **连接钱包后**
  - ✅ 显示用户地址（截断：0x742d...bEb1）
  - ✅ 显示 "开始验证" 按钮
  - ✅ 提示文案：需要 Coinbase 验证

- [ ] **验证进行中**
  - ✅ 按钮变为 "验证中... X%"
  - ✅ 显示进度条（0 → 100%）
  - ✅ 显示当前步骤：
    - "检查 Coinbase 验证状态..."
    - "生成零知识证明..."
    - "提交链上验证..."
  - ✅ Loading 动画流畅

- [ ] **验证成功**
  - ✅ 显示 ✅ 成功图标
  - ✅ 显示 "身份验证成功"
  - ✅ 显示会话剩余时间
  - ✅ 显示 "开始交易" 按钮

- [ ] **验证失败**
  - ✅ 显示 ❌ 错误图标
  - ✅ 显示具体错误原因
  - ✅ 提供重试按钮
  - ✅ 错误提示友好（非技术术语）

##### 3.2 交易界面 UI

**页面**: `/trade`

- [ ] **未验证状态**
  - ✅ 显示 "需要验证身份"
  - ✅ 显示 "立即验证" 按钮
  - ✅ 交易表单禁用

- [ ] **已验证状态**
  - ✅ 显示 Session 状态卡片（绿色）
  - ✅ 显示剩余时间倒计时
  - ✅ 交易表单启用

- [ ] **交易表单**
  - ✅ From Token 下拉菜单（ETH/USDC/WBTC）
  - ✅ 金额输入框
  - ✅ 交换按钮（上下翻转）
  - ✅ To Token 下拉菜单
  - ✅ 预估输出显示

- [ ] **交易信息**
  - ✅ 显示价格（1 ETH = ? USDC）
  - ✅ 显示滑点容差（0.5%）
  - ✅ 显示预估 Gas 费用

- [ ] **交易按钮**
  - ✅ 未输入金额 → 按钮禁用
  - ✅ 输入金额后 → 按钮启用
  - ✅ 点击后 → 显示 "交易中..."
  - ✅ 交易成功 → 显示成功提示

- [ ] **错误处理**
  - ✅ Session 过期 → 提示重新验证
  - ✅ 余额不足 → 显示余额不足
  - ✅ 交易失败 → 显示失败原因

##### 3.3 Session 状态组件

**组件**: `SessionStatus`（右上角）

- [ ] **显示正确**
  - ✅ 已验证：绿色指示灯 + "已验证"
  - ✅ 未验证：红色指示灯 + "未验证"
  - ✅ 剩余时间倒计时
  - ✅ 地址截断显示

- [ ] **交互**
  - ✅ 点击刷新按钮 → 更新状态
  - ✅ 自动每秒更新倒计时

##### 3.4 响应式设计

- [ ] **桌面端 (> 1024px)**
  - ✅ 居中布局
  - ✅ 卡片宽度 max-w-md
  - ✅ 按钮大小合适

- [ ] **平板端 (768px - 1024px)**
  - ✅ 布局适配
  - ✅ 字体大小调整

- [ ] **移动端 (< 768px)**
  - ✅ 全宽布局
  - ✅ 按钮足够大（易点击）
  - ✅ 输入框大小合适
  - ✅ 文字可读（不过小）

---

#### 4. 加载状态测试 ⏳

- [ ] **初始加载**
  - ✅ 显示 Loading 骨架屏
  - ✅ 避免布局闪烁

- [ ] **数据加载**
  - ✅ Session 状态加载中 → 显示 "..."
  - ✅ 价格查询中 → 显示 "计算中..."

- [ ] **ZK Proof 生成**
  - ✅ 进度条平滑过渡
  - ✅ 百分比准确
  - ✅ 不卡顿

---

#### 5. 错误场景测试 ⚠️

##### 网络错误

- [ ] **RPC 错误**
  - 关闭网络
  - 尝试验证
  - ✅ 显示 "网络连接失败，请检查网络"
  - ✅ 提供重试按钮

- [ ] **合约错误**
  - 模拟合约 Revert
  - ✅ 显示具体错误原因
  - ✅ 不显示原始错误（如 "execution reverted"）

##### 钱包错误

- [ ] **拒绝签名**
  - 点击验证
  - 在钱包中点击 "拒绝"
  - ✅ 显示 "签名被拒绝"
  - ✅ 提供重试

- [ ] **切换账户**
  - 验证后在钱包中切换账户
  - ✅ 检测到账户变化
  - ✅ 提示重新验证

- [ ] **切换网络**
  - 验证后切换到其他链
  - ✅ 检测到网络变化
  - ✅ 提示切回 Base

##### Session 错误

- [ ] **Session 过期**
  - 等待 24 小时（或用 mock 模拟）
  - ✅ Session 状态变为 "已过期"
  - ✅ 交易按钮禁用
  - ✅ 提示重新验证

- [ ] **Session 未激活**
  - 未验证用户访问 `/trade`
  - ✅ 显示 "需要验证身份"
  - ✅ 提供验证链接

---

#### 6. 浏览器兼容性测试 🌐

- [ ] **Chrome (推荐)**
  - ✅ 所有功能正常
  - ✅ Web Worker 支持
  - ✅ RainbowKit 显示正常

- [ ] **Brave**
  - ✅ 所有功能正常
  - ✅ 广告拦截不影响

- [ ] **Firefox**
  - ✅ 所有功能正常
  - ✅ 性能可接受

- [ ] **Safari (Mac/iOS)**
  - ✅ 所有功能正常
  - ⚠️ 注意 Safari 的 IndexedDB 限制

- [ ] **移动端浏览器**
  - ✅ iOS Safari
  - ✅ Android Chrome
  - ✅ 钱包内嵌浏览器

---

#### 7. 可访问性测试 ♿

- [ ] **键盘导航**
  - ✅ Tab 键可以遍历所有交互元素
  - ✅ Enter 键可以触发按钮
  - ✅ Esc 键可以关闭弹窗

- [ ] **屏幕阅读器**
  - ✅ 所有按钮有 aria-label
  - ✅ 表单输入有 label
  - ✅ 错误提示可被读取

- [ ] **对比度**
  - ✅ 文字与背景对比度 ≥ 4.5:1
  - ✅ 按钮与背景对比度 ≥ 3:1

---

## 🤖 自动化 UI 测试

### Playwright 测试（推荐）

#### 安装

```bash
cd frontend
npm install -D @playwright/test
npx playwright install
```

#### 测试示例

创建 `frontend/tests/e2e/verification.spec.ts`:

```typescript
import { test, expect } from '@playwright/test';

test.describe('验证流程', () => {
  test('完整验证流程', async ({ page }) => {
    // 1. 访问首页
    await page.goto('http://localhost:3000');
    
    // 2. 连接钱包（需要模拟）
    await page.click('text=连接钱包');
    
    // 3. 检查验证按钮显示
    await expect(page.locator('text=开始验证')).toBeVisible();
    
    // 4. 点击验证
    await page.click('text=开始验证');
    
    // 5. 等待 Loading 显示
    await expect(page.locator('text=验证中...')).toBeVisible();
    
    // 6. 等待验证完成（最多 60 秒）
    await expect(page.locator('text=身份验证成功')).toBeVisible({
      timeout: 60000
    });
    
    // 7. 检查 Session 状态
    await expect(page.locator('text=已验证')).toBeVisible();
  });
  
  test('验证失败处理', async ({ page }) => {
    await page.goto('http://localhost:3000');
    
    // 模拟验证失败
    // ...
    
    // 检查错误提示
    await expect(page.locator('text=验证失败')).toBeVisible();
    await expect(page.locator('text=重试')).toBeVisible();
  });
});
```

#### 运行测试

```bash
# 运行所有测试
npx playwright test

# 运行单个文件
npx playwright test tests/e2e/verification.spec.ts

# 开启 UI 模式（可视化）
npx playwright test --ui
```

---

## 📊 UI 测试报告模板

### 测试执行记录

**测试日期**: 2026-02-10  
**测试人员**: ___  
**测试环境**: ___

#### 1. ZK 性能测试

| 设备 | CPU | RAM | 首次生成 | 二次生成 | 通过/失败 |
|------|-----|-----|---------|---------|----------|
| 低配 | | | | | |
| 中配 | | | | | |
| 高配 | | | | | |

#### 2. 钱包兼容性

| 钱包 | 连接 | 签名 | 交易 | 通过/失败 |
|------|-----|-----|-----|----------|
| MetaMask | ☐ | ☐ | ☐ | |
| Coinbase Wallet | ☐ | ☐ | ☐ | |
| Rainbow | ☐ | ☐ | ☐ | |

#### 3. 浏览器兼容性

| 浏览器 | 桌面端 | 移动端 | 通过/失败 |
|--------|--------|--------|----------|
| Chrome | ☐ | ☐ | |
| Brave | ☐ | ☐ | |
| Firefox | ☐ | N/A | |
| Safari | ☐ | ☐ | |

#### 4. UI/UX 问题记录

| 问题 | 严重程度 | 状态 | 备注 |
|------|---------|------|------|
| | | | |

---

## 🚀 快速测试流程

### 5 分钟烟雾测试

```bash
# 1. 启动开发服务器
cd frontend
npm run dev

# 2. 打开浏览器 http://localhost:3000

# 3. 快速检查清单
☐ 页面加载正常
☐ 连接钱包按钮显示
☐ 点击连接 → MetaMask 弹出
☐ 连接成功 → 地址显示
☐ 开始验证按钮可点击
☐ 点击验证 → Loading 显示
☐ 验证完成 → 成功提示

# 如果以上全部通过 ✅，UI 基础功能正常
```

---

## 📚 测试工具推荐

### 性能监控
- **Chrome DevTools** - Performance, Network, Memory
- **Lighthouse** - 性能评分和建议

### 自动化测试
- **Playwright** - E2E 测试（推荐）
- **Cypress** - 备选方案
- **Jest + React Testing Library** - 组件测试

### 视觉回归测试
- **Percy** - 截图对比
- **Chromatic** - Storybook 集成

### 可访问性测试
- **axe DevTools** - Chrome 扩展
- **WAVE** - 在线检查工具

---

## ⚠️ 测试注意事项

### Mock 数据

在没有真实后端时，使用 Mock:

```typescript
// frontend/lib/mocks.ts
export const MOCK_SESSION = {
  isActive: true,
  expiry: Date.now() + 24 * 60 * 60 * 1000,
  user: '0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb1'
};
```

### 环境变量

```bash
# .env.local
NEXT_PUBLIC_ENABLE_MOCK=true  # 开启 Mock 模式
NEXT_PUBLIC_SKIP_ZK_PROOF=true  # 跳过 ZK 生成（快速测试）
```

---

## 🎯 上线前最终检查

- [ ] **所有 7 项 UI 测试通过**
- [ ] **3 种钱包全部兼容**
- [ ] **5 种浏览器全部支持**
- [ ] **移动端适配完美**
- [ ] **ZK 性能达标（< 30s）**
- [ ] **无严重 Bug**
- [ ] **用户体验流畅**

---

**维护者**: ILAL 前端团队  
**最后更新**: 2026-02-10
