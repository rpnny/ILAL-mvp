# PostgreSQL 简易安装步骤

## 方法：在终端中逐步执行

打开终端，**逐条复制粘贴**以下命令（每条命令后按回车）：

---

### 步骤 1: 安装 Homebrew

```bash
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```

- 会提示输入密码，输入后按回车
- 安装大约需要 2-3 分钟

完成后，如果是 Apple Silicon Mac，还需要运行：

```bash
echo 'eval "$(/opt/homebrew/bin/brew shellenv)"' >> ~/.zprofile
eval "$(/opt/homebrew/bin/brew shellenv)"
```

---

### 步骤 2: 安装 PostgreSQL

```bash
brew install postgresql@14
```

- 安装大约需要 2-3 分钟
- 不需要输入密码

---

### 步骤 3: 启动 PostgreSQL 服务

```bash
brew services start postgresql@14
```

---

### 步骤 4: 配置环境变量（Apple Silicon Mac）

```bash
export PATH="/opt/homebrew/opt/postgresql@14/bin:$PATH"
```

或者（Intel Mac）：

```bash
export PATH="/usr/local/opt/postgresql@14/bin:$PATH"
```

---

### 步骤 5: 创建数据库

```bash
createdb ilal_dev
```

---

### 步骤 6: 安装 pnpm

```bash
sudo npm install -g pnpm
```

- 需要输入密码

---

### 步骤 7: 配置 ILAL 项目

```bash
cd /Users/ronny/Desktop/ilal/apps/api
```

备份旧配置：

```bash
cp .env .env.sqlite
cp prisma/schema.prisma prisma/schema.sqlite.backup
```

---

### 步骤 8: 创建新的环境变量

```bash
cat > .env << 'EOF'
DATABASE_URL="postgresql://ronny@localhost:5432/ilal_dev"
JWT_SECRET="$(openssl rand -hex 32)"
JWT_EXPIRES_IN="7d"
JWT_REFRESH_EXPIRES_IN="30d"
API_KEY_SECRET="$(openssl rand -hex 32)"
PORT=3001
NODE_ENV="development"
RPC_URL="https://base-sepolia-rpc.publicnode.com"
CHAIN_ID=84532
VERIFIER_PRIVATE_KEY="0x$(openssl rand -hex 32)"
SESSION_MANAGER_ADDRESS="0x53fA67Dbe5803432Ba8697Ac94C80B601Eb850e2"
VERIFIER_ADDRESS="0x0cDcD82E5efba9De4aCc255402968397F323AFBB"
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX_REQUESTS_FREE=10
RATE_LIMIT_MAX_REQUESTS_PRO=100
RATE_LIMIT_MAX_REQUESTS_ENTERPRISE=1000
EOF
```

---

### 步骤 9: 切换到 PostgreSQL Schema

```bash
cp prisma/schema.postgresql.prisma prisma/schema.prisma
```

---

### 步骤 10: 生成 Prisma Client 并运行迁移

```bash
npx prisma generate
npx prisma migrate dev --name init_postgresql
```

---

### 步骤 11: 启动服务

```bash
npm run dev
```

---

### 步骤 12: 测试（在新终端窗口）

```bash
cd /Users/ronny/Desktop/ilal/apps/api
npx tsx test-e2e.ts
```

---

## 完成！

✅ PostgreSQL 已安装并配置完成！

## 常用命令

```bash
# 启动/停止 PostgreSQL
brew services start postgresql@14
brew services stop postgresql@14

# 连接数据库
psql -d ilal_dev

# 可视化管理
npx prisma studio
```

