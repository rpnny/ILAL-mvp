# ✅ 生产环境部署检查清单

使用此清单确保生产部署的安全和稳定。

---

## 📋 部署前检查

### 代码质量
- [ ] 所有单元测试通过
- [ ] 集成测试通过
- [ ] 代码已通过 Lint 检查
- [ ] 移除所有 `console.log` 调试代码
- [ ] 移除测试数据和模拟代码
- [ ] 代码已提交到 Git 仓库

### 安全配置
- [ ] `.env` 文件已添加到 `.gitignore`
- [ ] 所有密钥都是生产级强度（32+ 字符）
- [ ] JWT Secret 已更新为强随机值
- [ ] API Key Secret 已更新为强随机值
- [ ] 数据库密码是强密码
- [ ] CORS 配置为特定域名（非 `*`）
- [ ] 已禁用调试模式
- [ ] 错误消息不暴露敏感信息

### 环境变量
- [ ] `NODE_ENV=production`
- [ ] `DATABASE_URL` - 生产数据库连接字符串
- [ ] `JWT_SECRET` - 强随机密钥
- [ ] `API_KEY_SECRET` - 强随机密钥
- [ ] `RESEND_API_KEY` - Resend 邮件服务密钥
- [ ] `FROM_EMAIL` - 发件人邮箱
- [ ] `CORS_ORIGIN` - 允许的前端域名
- [ ] `PORT` - 端口号（通常 3001）
- [ ] `VERIFIER_PRIVATE_KEY` - 区块链验证私钥（可选）

### 数据库
- [ ] PostgreSQL 数据库已创建
- [ ] 数据库连接测试成功
- [ ] 数据库迁移已准备
- [ ] 备份策略已制定
- [ ] 数据库使用 SSL 连接
- [ ] 数据库访问 IP 已限制

### 邮件服务
- [ ] Resend 账号已创建
- [ ] API Key 已生成并配置
- [ ] 发送域名已验证（推荐）
- [ ] SPF/DKIM/DMARC 记录已配置（推荐）
- [ ] 测试邮件发送成功

---

## 🚀 部署过程检查

### 构建和部署
- [ ] 应用成功构建
- [ ] Docker 镜像构建成功（如使用）
- [ ] 依赖包全部安装
- [ ] Prisma Client 已生成
- [ ] TypeScript 编译成功
- [ ] 应用成功启动

### 数据库迁移
- [ ] 数据库迁移已运行：`npx prisma migrate deploy`
- [ ] 所有表已创建
- [ ] 索引已创建
- [ ] 数据完整性检查通过

### 服务配置
- [ ] 端口配置正确
- [ ] 环境变量已加载
- [ ] 日志记录正常
- [ ] 健康检查端点可访问
- [ ] HTTPS 已启用
- [ ] SSL 证书有效

---

## ✅ 部署后验证

### 基础功能测试
- [ ] 健康检查 API 返回 200 OK
  ```bash
  curl https://your-app.com/api/v1/health
  ```

- [ ] 用户注册成功
  ```bash
  curl -X POST https://your-app.com/api/v1/auth/register \
    -H "Content-Type: application/json" \
    -d '{"email":"test@example.com","password":"Test1234!@#$"}'
  ```

- [ ] 验证邮件成功发送

- [ ] 邮箱验证成功

- [ ] 用户登录成功

- [ ] API Key 创建成功

- [ ] API Key 认证成功

### 安全测试
- [ ] SQL 注入测试通过
- [ ] XSS 攻击测试通过
- [ ] CSRF 保护启用
- [ ] 速率限制生效
- [ ] 无效 Token 被拒绝
- [ ] 过期 Token 被拒绝
- [ ] 敏感数据不在日志中暴露

### 性能测试
- [ ] 响应时间 < 500ms
- [ ] 并发请求处理正常
- [ ] 数据库连接池配置合理
- [ ] 内存使用正常
- [ ] CPU 使用正常

---

## 📊 监控和告警

### 日志配置
- [ ] 应用日志正常记录
- [ ] 错误日志单独记录
- [ ] 日志轮转已配置
- [ ] 日志保留期已设置
- [ ] 敏感信息已脱敏

### 监控设置
- [ ] 健康检查监控已启用
- [ ] 错误率监控已启用
- [ ] 响应时间监控已启用
- [ ] 数据库性能监控已启用
- [ ] 服务器资源监控已启用

### 告警配置
- [ ] 服务宕机告警
- [ ] 错误率过高告警
- [ ] 响应时间过长告警
- [ ] 数据库连接失败告警
- [ ] 磁盘空间不足告警
- [ ] 邮件发送失败告警

### 备份策略
- [ ] 数据库自动备份已启用
- [ ] 备份频率：每日
- [ ] 备份保留期：30 天
- [ ] 备份恢复测试通过
- [ ] 备份存储位置安全

---

## 🔒 安全加固

### API 安全
- [ ] API 版本控制已实施
- [ ] 速率限制已配置
  - FREE: 10 请求/分钟
  - PRO: 100 请求/分钟
  - ENTERPRISE: 1000 请求/分钟
- [ ] IP 白名单已配置（如需要）
- [ ] API 文档已更新
- [ ] 敏感端点额外保护

### 密钥管理
- [ ] 密钥轮换策略已制定（建议 6 个月）
- [ ] 密钥存储在安全位置
- [ ] 开发和生产环境密钥分离
- [ ] 密钥访问权限受限
- [ ] 密钥泄露应急预案已制定

### 数据保护
- [ ] 密码使用 bcrypt 加密
- [ ] API Key 使用 bcrypt 加密
- [ ] 敏感数据传输使用 HTTPS
- [ ] 数据库备份加密
- [ ] GDPR 合规（如适用）

---

## 🌐 域名和网络

### 域名配置
- [ ] 自定义域名已绑定
- [ ] DNS 记录已配置
- [ ] SSL 证书已安装
- [ ] SSL 证书自动续期已配置
- [ ] HTTPS 强制跳转已启用

### 网络配置
- [ ] CDN 已配置（如需要）
- [ ] 负载均衡已配置（如需要）
- [ ] 防火墙规则已设置
- [ ] DDoS 保护已启用
- [ ] 流量监控已启用

---

## 📚 文档和通信

### 文档更新
- [ ] API 文档已更新
- [ ] 部署文档已更新
- [ ] 运维手册已准备
- [ ] 故障排查指南已准备
- [ ] 变更日志已更新

### 团队通信
- [ ] 部署时间已通知团队
- [ ] 维护窗口已通知用户
- [ ] 回滚计划已准备
- [ ] 紧急联系方式已更新
- [ ] 部署后报告已准备

---

## 🔧 运维准备

### 监控工具
- [ ] 日志聚合工具已配置（如 LogRocket、Datadog）
- [ ] 错误追踪工具已配置（如 Sentry）
- [ ] 性能监控工具已配置（如 New Relic）
- [ ] 正常运行时间监控已配置（如 UptimeRobot）

### 运维脚本
- [ ] 数据库备份脚本已准备
- [ ] 日志清理脚本已准备
- [ ] 健康检查脚本已准备
- [ ] 自动重启脚本已准备

### 应急响应
- [ ] 回滚流程已文档化
- [ ] 紧急修复流程已文档化
- [ ] 数据恢复流程已文档化
- [ ] 联系人列表已更新
- [ ] 值班计划已制定

---

## 📈 性能优化

### 应用优化
- [ ] 数据库查询已优化
- [ ] 索引已正确创建
- [ ] 缓存策略已实施
- [ ] 静态资源已压缩
- [ ] 代码已压缩

### 服务器优化
- [ ] 服务器规格适当
- [ ] 自动扩展已配置（如需要）
- [ ] 连接池已优化
- [ ] 内存限制已设置
- [ ] CPU 限制已设置

---

## ✅ 最终确认

### 签字确认
- [ ] 技术负责人已审核
- [ ] 项目经理已批准
- [ ] 安全团队已审核
- [ ] 运维团队已准备

### 部署执行
- [ ] 部署时间已确认
- [ ] 团队成员已到位
- [ ] 监控系统已准备
- [ ] 回滚计划已就绪

---

## 🎉 部署完成

- [ ] 所有检查项已完成
- [ ] 部署报告已提交
- [ ] 监控正常运行
- [ ] 用户通知已发送
- [ ] 文档已更新

---

## 📞 紧急联系方式

**技术负责人**: 
**运维负责人**: 
**项目经理**: 

**紧急情况处理流程**: 
1. 立即回滚到上一个稳定版本
2. 通知技术负责人
3. 查看错误日志定位问题
4. 修复并重新部署
5. 编写事后分析报告

---

**部署日期**: __________
**部署人员**: __________
**审核人员**: __________

🎉 恭喜！你已完成生产环境部署检查！
## Fri Feb 27 11:04:55 CST 2026
